{"ast":null,"code":"'use strict';import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _defineProperty2 from\"@babel/runtime/helpers/defineProperty\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty2(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}import{registerEventHandler,unregisterEventHandler}from'./core';import{shouldBeUseWeb}from'./PlatformChecker';var SHOULD_BE_USE_WEB=shouldBeUseWeb();function jsListener(eventName,handler){return function(evt){handler(_objectSpread(_objectSpread({},evt.nativeEvent),{},{eventName:eventName}));};}var WorkletEventHandler=function(){function WorkletEventHandler(worklet){_classCallCheck(this,WorkletEventHandler);var eventNames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_defineProperty(this,\"worklet\",void 0);_defineProperty(this,\"eventNames\",void 0);_defineProperty(this,\"reattachNeeded\",void 0);_defineProperty(this,\"listeners\",void 0);_defineProperty(this,\"viewTag\",void 0);_defineProperty(this,\"registrations\",void 0);this.worklet=worklet;this.eventNames=eventNames;this.reattachNeeded=false;this.listeners={};this.viewTag=undefined;this.registrations=[];if(SHOULD_BE_USE_WEB){this.listeners=eventNames.reduce(function(acc,eventName){acc[eventName]=jsListener(eventName,worklet);return acc;},{});}}_createClass(WorkletEventHandler,[{key:\"updateWorklet\",value:function updateWorklet(newWorklet){this.worklet=newWorklet;this.reattachNeeded=true;}},{key:\"registerForEvents\",value:function registerForEvents(viewTag,fallbackEventName){var _this=this;this.viewTag=viewTag;this.registrations=this.eventNames.map(function(eventName){return registerEventHandler(_this.worklet,eventName,viewTag);});if(this.registrations.length===0&&fallbackEventName){this.registrations.push(registerEventHandler(this.worklet,fallbackEventName,viewTag));}}},{key:\"registerForEventByName\",value:function registerForEventByName(eventName){this.registrations.push(registerEventHandler(this.worklet,eventName));}},{key:\"unregisterFromEvents\",value:function unregisterFromEvents(){this.registrations.forEach(function(id){return unregisterEventHandler(id);});this.registrations=[];}}]);return WorkletEventHandler;}();export{WorkletEventHandler as default};","map":{"version":3,"sources":["WorkletEventHandler.ts"],"names":["registerEventHandler","unregisterEventHandler","shouldBeUseWeb","SHOULD_BE_USE_WEB","jsListener","eventName","handler","evt","nativeEvent","WorkletEventHandler","constructor","worklet","eventNames","_defineProperty","reattachNeeded","listeners","viewTag","undefined","registrations","reduce","acc","updateWorklet","newWorklet","registerForEvents","fallbackEventName","map","length","push","registerForEventByName","unregisterFromEvents","forEach","id"],"mappings":"AAAA,YAAY,CAAA,OAAA,eAAA,oDAAA,YAAA,iDAAA,gBAAA,sDAAA,QAAA,CAAA,CAAA,CAAA,MAAA,CAAA,CAAA,MAAA,CAAA,IAAA,CAAA,CAAA,KAAA,MAAA,CAAA,qBAAA,MAAA,CAAA,CAAA,MAAA,CAAA,qBAAA,CAAA,CAAA,EAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA,MAAA,UAAA,CAAA,SAAA,MAAA,CAAA,wBAAA,CAAA,CAAA,CAAA,CAAA,EAAA,UAAA,KAAA,CAAA,CAAA,IAAA,CAAA,KAAA,CAAA,CAAA,CAAA,CAAA,UAAA,CAAA,WAAA,cAAA,CAAA,UAAA,CAAA,GAAA,CAAA,CAAA,SAAA,CAAA,MAAA,CAAA,CAAA,QAAA,CAAA,OAAA,SAAA,CAAA,CAAA,EAAA,SAAA,CAAA,CAAA,KAAA,CAAA,GAAA,OAAA,CAAA,MAAA,CAAA,CAAA,MAAA,OAAA,UAAA,CAAA,EAAA,gBAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,MAAA,MAAA,CAAA,yBAAA,CAAA,MAAA,CAAA,gBAAA,CAAA,CAAA,CAAA,MAAA,CAAA,yBAAA,CAAA,CAAA,GAAA,OAAA,CAAA,MAAA,CAAA,CAAA,GAAA,OAAA,UAAA,CAAA,EAAA,MAAA,CAAA,cAAA,CAAA,CAAA,CAAA,CAAA,CAAA,MAAA,CAAA,wBAAA,CAAA,CAAA,CAAA,CAAA,cAAA,CAAA,EAAC,QAAA,CAAA,eAAA,CAAA,GAAA,CAAA,GAAA,CAAA,KAAA,CAAA,CAAA,GAAA,CAAA,cAAA,CAAA,GAAA,CAAA,CAAA,GAAA,GAAA,GAAA,CAAA,GAAA,CAAA,CAAA,MAAA,CAAA,cAAA,CAAA,GAAA,CAAA,GAAA,CAAA,CAAA,KAAA,CAAA,KAAA,CAAA,UAAA,CAAA,IAAA,CAAA,YAAA,CAAA,IAAA,CAAA,QAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,IAAA,CAAA,GAAA,CAAA,GAAA,CAAA,CAAA,KAAA,CAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,QAAA,CAAA,cAAA,CAAA,GAAA,CAAA,CAAA,GAAA,CAAA,GAAA,CAAA,YAAA,CAAA,GAAA,CAAA,QAAA,CAAA,CAAA,MAAA,OAAA,CAAA,GAAA,GAAA,QAAA,CAAA,GAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,CAAA,QAAA,CAAA,YAAA,CAAA,KAAA,CAAA,IAAA,CAAA,CAAA,GAAA,MAAA,CAAA,KAAA,GAAA,QAAA,EAAA,KAAA,GAAA,IAAA,CAAA,MAAA,CAAA,KAAA,CAAA,GAAA,CAAA,IAAA,CAAA,KAAA,CAAA,MAAA,CAAA,WAAA,CAAA,CAAA,GAAA,IAAA,GAAA,SAAA,CAAA,CAAA,GAAA,CAAA,GAAA,CAAA,IAAA,CAAA,IAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA,CAAA,GAAA,MAAA,CAAA,GAAA,GAAA,QAAA,CAAA,MAAA,CAAA,GAAA,CAAA,KAAA,IAAA,CAAA,SAAA,CAAA,8CAAA,CAAA,CAAA,CAAA,MAAA,CAAA,IAAA,GAAA,QAAA,CAAA,MAAA,CAAA,MAAA,EAAA,KAAA,CAAA,CAAA,CAEb,OAASA,oBAAoB,CAAEC,sBAAsB,KAAQ,QAAQ,CAErE,OAASC,cAAc,KAAQ,mBAAmB,CAElD,GAAMC,CAAAA,iBAAiB,CAAGD,cAAc,CAAA,CAAE,CAO1C,QAASE,CAAAA,UAAUA,CACjBC,SAAiB,CACjBC,OAAgD,CAChD,CACA,MAAQC,UAAAA,GAAmB,CAAK,CAC9BD,OAAO,CAAA,aAAA,CAAA,aAAA,IAAMC,GAAG,CAACC,WAAW,MAAEH,SAAAA,CAAAA,SAAAA,EAAW,CAA2B,CACtE,CAAC,CACH,CAAA,GAEqBI,CAAAA,mBAAmB,YAUtCC,SAAAA,oBACEC,OAAgD,CAEhD,CAAA,eAAA,MAAA,mBAAA,EAAA,GADAC,CAAAA,UAAoB,CAAA,SAAA,CAAA,MAAA,CAAA,CAAA,EAAA,SAAA,CAAA,CAAA,CAAA,GAAA,SAAA,CAAA,SAAA,CAAA,CAAA,CAAA,CAAG,EAAEC,CAAAA,eAAAA,CAAAA,IAAAA,CAAAA,SAAAA,CAAAA,IAAAA,EAAAA,CAAAA,CAAAA,eAAAA,CAAAA,IAAAA,CAAAA,YAAAA,CAAAA,IAAAA,EAAAA,CAAAA,CAAAA,eAAAA,CAAAA,IAAAA,CAAAA,gBAAAA,CAAAA,IAAAA,EAAAA,CAAAA,CAAAA,eAAAA,CAAAA,IAAAA,CAAAA,WAAAA,CAAAA,IAAAA,EAAAA,CAAAA,CAAAA,eAAAA,CAAAA,IAAAA,CAAAA,SAAAA,CAAAA,IAAAA,EAAAA,CAAAA,CAAAA,eAAAA,CAAAA,IAAAA,CAAAA,eAAAA,CAAAA,IAAAA,EAAAA,CAAAA,CAEzB,IAAI,CAACF,OAAO,CAAGA,OAAO,CACtB,IAAI,CAACC,UAAU,CAAGA,UAAU,CAC5B,IAAI,CAACE,cAAc,CAAG,KAAK,CAC3B,IAAI,CAACC,SAAS,CAAG,CAAC,CAAC,CACnB,IAAI,CAACC,OAAO,CAAGC,SAAS,CACxB,IAAI,CAACC,aAAa,CAAG,EAAE,CAEvB,GAAIf,iBAAiB,CAAE,CACrB,IAAI,CAACY,SAAS,CAAGH,UAAU,CAACO,MAAM,CAChC,SACEC,GAAoD,CACpDf,SAAiB,CACd,CACHe,GAAG,CAACf,SAAS,CAAC,CAAGD,UAAU,CAACC,SAAS,CAAEM,OAAO,CAAC,CAC/C,MAAOS,CAAAA,GAAG,CACZ,CAAC,CACD,CAAC,CAAC,CACH,CACH,CACF,CAAA,YAAA,CAAA,mBAAA,GAAA,GAAA,iBAAA,KAAA,CAEAC,SAAAA,cAAcC,UAAmD,CAAQ,CACvE,IAAI,CAACX,OAAO,CAAGW,UAAU,CACzB,IAAI,CAACR,cAAc,CAAG,IAAI,CAC5B,CAAA,GAAA,GAAA,qBAAA,KAAA,CAEAS,SAAAA,kBAAkBP,OAAe,CAAEQ,iBAA0B,CAAQ,KAAA,KAAA,MACnE,IAAI,CAACR,OAAO,CAAGA,OAAO,CACtB,IAAI,CAACE,aAAa,CAAG,IAAI,CAACN,UAAU,CAACa,GAAG,CAAEpB,SAAAA,SAAS,QACjDL,CAAAA,oBAAoB,CAAC,KAAI,CAACW,OAAO,CAAEN,SAAS,CAAEW,OAAO,CAAC,GACvD,CACD,GAAI,IAAI,CAACE,aAAa,CAACQ,MAAM,GAAK,CAAC,EAAIF,iBAAiB,CAAE,CACxD,IAAI,CAACN,aAAa,CAACS,IAAI,CACrB3B,oBAAoB,CAAC,IAAI,CAACW,OAAO,CAAEa,iBAAiB,CAAER,OAAO,CAAC,CAC/D,CACH,CACF,CAAA,GAAA,GAAA,0BAAA,KAAA,CAEAY,SAAAA,uBAAuBvB,SAAiB,CAAE,CACxC,IAAI,CAACa,aAAa,CAACS,IAAI,CAAC3B,oBAAoB,CAAC,IAAI,CAACW,OAAO,CAAEN,SAAS,CAAC,CAAC,CACxE,CAAA,GAAA,GAAA,wBAAA,KAAA,CAEAwB,SAAAA,qBAAAA,CAA6B,CAC3B,IAAI,CAACX,aAAa,CAACY,OAAO,CAAEC,SAAAA,EAAE,QAAK9B,CAAAA,sBAAsB,CAAC8B,EAAE,CAAC,GAAC,CAC9D,IAAI,CAACb,aAAa,CAAG,EAAE,CACzB,CAAA,WAAA,mBAAA,YA3DmBT,mBAAmB,IAAA,OAAA","sourcesContent":["'use strict';\nimport type { NativeSyntheticEvent } from 'react-native';\nimport { registerEventHandler, unregisterEventHandler } from './core';\nimport type { EventPayload, ReanimatedEvent } from './hook/commonTypes';\nimport { shouldBeUseWeb } from './PlatformChecker';\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\ntype JSEvent<Event extends object> = NativeSyntheticEvent<EventPayload<Event>>;\n\n// In JS implementation (e.g. for web) we don't use Reanimated's\n// event emitter, therefore we have to handle here\n// the event that came from React Native and convert it.\nfunction jsListener<Event extends object>(\n  eventName: string,\n  handler: (event: ReanimatedEvent<Event>) => void\n) {\n  return (evt: JSEvent<Event>) => {\n    handler({ ...evt.nativeEvent, eventName } as ReanimatedEvent<Event>);\n  };\n}\n\nexport default class WorkletEventHandler<Event extends object> {\n  worklet: (event: ReanimatedEvent<Event>) => void;\n  eventNames: string[];\n  reattachNeeded: boolean;\n  listeners:\n    | Record<string, (event: ReanimatedEvent<ReanimatedEvent<Event>>) => void>\n    | Record<string, (event: JSEvent<Event>) => void>;\n\n  viewTag: number | undefined;\n  registrations: number[];\n  constructor(\n    worklet: (event: ReanimatedEvent<Event>) => void,\n    eventNames: string[] = []\n  ) {\n    this.worklet = worklet;\n    this.eventNames = eventNames;\n    this.reattachNeeded = false;\n    this.listeners = {};\n    this.viewTag = undefined;\n    this.registrations = [];\n\n    if (SHOULD_BE_USE_WEB) {\n      this.listeners = eventNames.reduce(\n        (\n          acc: Record<string, (event: JSEvent<Event>) => void>,\n          eventName: string\n        ) => {\n          acc[eventName] = jsListener(eventName, worklet);\n          return acc;\n        },\n        {}\n      );\n    }\n  }\n\n  updateWorklet(newWorklet: (event: ReanimatedEvent<Event>) => void): void {\n    this.worklet = newWorklet;\n    this.reattachNeeded = true;\n  }\n\n  registerForEvents(viewTag: number, fallbackEventName?: string): void {\n    this.viewTag = viewTag;\n    this.registrations = this.eventNames.map((eventName) =>\n      registerEventHandler(this.worklet, eventName, viewTag)\n    );\n    if (this.registrations.length === 0 && fallbackEventName) {\n      this.registrations.push(\n        registerEventHandler(this.worklet, fallbackEventName, viewTag)\n      );\n    }\n  }\n\n  registerForEventByName(eventName: string) {\n    this.registrations.push(registerEventHandler(this.worklet, eventName));\n  }\n\n  unregisterFromEvents(): void {\n    this.registrations.forEach((id) => unregisterEventHandler(id));\n    this.registrations = [];\n  }\n}\n"]},"metadata":{},"sourceType":"module"}