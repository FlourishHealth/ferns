{"ast":null,"code":"'use strict';import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}import NativeEventEmitter from\"react-native-web/dist/exports/NativeEventEmitter\";import NativeModules from\"react-native-web/dist/exports/NativeModules\";import findNodeHandle from\"react-native-web/dist/exports/findNodeHandle\";import{shouldBeUseWeb}from'../reanimated2/PlatformChecker';import{runOnJS,runOnUIImmediately}from'../reanimated2/threads';var SHOULD_BE_USE_WEB=shouldBeUseWeb();var JSPropsUpdaterPaper=function(){function JSPropsUpdaterPaper(){_classCallCheck(this,JSPropsUpdaterPaper);_defineProperty(this,\"_reanimatedEventEmitter\",void 0);this._reanimatedEventEmitter=new NativeEventEmitter(NativeModules.ReanimatedModule);}_createClass(JSPropsUpdaterPaper,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(animatedComponent){var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterPaper._tagToComponentMapping.set(viewTag,animatedComponent);if(JSPropsUpdaterPaper._tagToComponentMapping.size===1){var listener=function listener(data){var component=JSPropsUpdaterPaper._tagToComponentMapping.get(data.viewTag);component===null||component===void 0?void 0:component._updateFromNative(data.props);};this._reanimatedEventEmitter.addListener('onReanimatedPropsChange',listener);}}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(animatedComponent){var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterPaper._tagToComponentMapping.delete(viewTag);if(JSPropsUpdaterPaper._tagToComponentMapping.size===0){this._reanimatedEventEmitter.removeAllListeners('onReanimatedPropsChange');}}}]);return JSPropsUpdaterPaper;}();_defineProperty(JSPropsUpdaterPaper,\"_tagToComponentMapping\",new Map());var _worklet_9991293657914_init_data={code:\"function anonymous(){const{runOnJS,updater}=this.__closure;global.updateJSProps=function(viewTag,props){runOnJS(updater)(viewTag,props);};}\"};var JSPropsUpdaterFabric=function(){function JSPropsUpdaterFabric(){_classCallCheck(this,JSPropsUpdaterFabric);if(!JSPropsUpdaterFabric.isInitialized){var updater=function updater(viewTag,props){var component=JSPropsUpdaterFabric._tagToComponentMapping.get(viewTag);component===null||component===void 0?void 0:component._updateFromNative(props);};runOnUIImmediately(function(){var anonymous=function anonymous(){global.updateJSProps=function(viewTag,props){runOnJS(updater)(viewTag,props);};};anonymous.__closure={runOnJS:runOnJS,updater:updater};anonymous.__workletHash=9991293657914;anonymous.__initData=_worklet_9991293657914_init_data;return anonymous;}())();JSPropsUpdaterFabric.isInitialized=true;}}_createClass(JSPropsUpdaterFabric,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(animatedComponent){if(!JSPropsUpdaterFabric.isInitialized){return;}var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterFabric._tagToComponentMapping.set(viewTag,animatedComponent);}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(animatedComponent){if(!JSPropsUpdaterFabric.isInitialized){return;}var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterFabric._tagToComponentMapping.delete(viewTag);}}]);return JSPropsUpdaterFabric;}();_defineProperty(JSPropsUpdaterFabric,\"_tagToComponentMapping\",new Map());_defineProperty(JSPropsUpdaterFabric,\"isInitialized\",false);var JSPropsUpdaterWeb=function(){function JSPropsUpdaterWeb(){_classCallCheck(this,JSPropsUpdaterWeb);}_createClass(JSPropsUpdaterWeb,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(_animatedComponent){}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(_animatedComponent){}}]);return JSPropsUpdaterWeb;}();var JSPropsUpdater;if(SHOULD_BE_USE_WEB){JSPropsUpdater=JSPropsUpdaterWeb;}else if(global._IS_FABRIC){JSPropsUpdater=JSPropsUpdaterFabric;}else{JSPropsUpdater=JSPropsUpdaterPaper;}export default JSPropsUpdater;","map":{"version":3,"names":["_classCallCheck","_createClass","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","NativeEventEmitter","NativeModules","findNodeHandle","shouldBeUseWeb","runOnJS","runOnUIImmediately","SHOULD_BE_USE_WEB","JSPropsUpdaterPaper","_reanimatedEventEmitter","ReanimatedModule","addOnJSPropsChangeListener","animatedComponent","viewTag","_tagToComponentMapping","set","size","listener","data","component","get","_updateFromNative","props","addListener","removeOnJSPropsChangeListener","delete","removeAllListeners","Map","_worklet_9991293657914_init_data","code","JSPropsUpdaterFabric","isInitialized","updater","anonymous","global","updateJSProps","__closure","__workletHash","__initData","JSPropsUpdaterWeb","_animatedComponent","JSPropsUpdater","_IS_FABRIC"],"sources":["/Users/josh/src/ui/node_modules/react-native-reanimated/lib/module/createAnimatedComponent/JSPropsUpdater.ts"],"sourcesContent":["'use strict';\nimport {\n  NativeEventEmitter,\n  NativeModules,\n  findNodeHandle,\n} from 'react-native';\nimport { shouldBeUseWeb } from '../reanimated2/PlatformChecker';\nimport type { StyleProps } from '../reanimated2';\nimport { runOnJS, runOnUIImmediately } from '../reanimated2/threads';\nimport type {\n  AnimatedComponentProps,\n  IAnimatedComponentInternal,\n  IJSPropsUpdater,\n  InitialComponentProps,\n} from './commonTypes';\n\ninterface ListenerData {\n  viewTag: number;\n  props: StyleProps;\n}\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\nclass JSPropsUpdaterPaper implements IJSPropsUpdater {\n  private static _tagToComponentMapping = new Map();\n  private _reanimatedEventEmitter: NativeEventEmitter;\n\n  constructor() {\n    this._reanimatedEventEmitter = new NativeEventEmitter(\n      NativeModules.ReanimatedModule\n    );\n  }\n\n  public addOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterPaper._tagToComponentMapping.set(viewTag, animatedComponent);\n    if (JSPropsUpdaterPaper._tagToComponentMapping.size === 1) {\n      const listener = (data: ListenerData) => {\n        const component = JSPropsUpdaterPaper._tagToComponentMapping.get(\n          data.viewTag\n        );\n        component?._updateFromNative(data.props);\n      };\n      this._reanimatedEventEmitter.addListener(\n        'onReanimatedPropsChange',\n        listener\n      );\n    }\n  }\n\n  public removeOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterPaper._tagToComponentMapping.delete(viewTag);\n    if (JSPropsUpdaterPaper._tagToComponentMapping.size === 0) {\n      this._reanimatedEventEmitter.removeAllListeners(\n        'onReanimatedPropsChange'\n      );\n    }\n  }\n}\n\nclass JSPropsUpdaterFabric implements IJSPropsUpdater {\n  private static _tagToComponentMapping = new Map();\n  private static isInitialized = false;\n\n  constructor() {\n    if (!JSPropsUpdaterFabric.isInitialized) {\n      const updater = (viewTag: number, props: unknown) => {\n        const component =\n          JSPropsUpdaterFabric._tagToComponentMapping.get(viewTag);\n        component?._updateFromNative(props);\n      };\n      runOnUIImmediately(() => {\n        'worklet';\n        global.updateJSProps = (viewTag: number, props: unknown) => {\n          runOnJS(updater)(viewTag, props);\n        };\n      })();\n      JSPropsUpdaterFabric.isInitialized = true;\n    }\n  }\n\n  public addOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    if (!JSPropsUpdaterFabric.isInitialized) {\n      return;\n    }\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterFabric._tagToComponentMapping.set(viewTag, animatedComponent);\n  }\n\n  public removeOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    if (!JSPropsUpdaterFabric.isInitialized) {\n      return;\n    }\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterFabric._tagToComponentMapping.delete(viewTag);\n  }\n}\n\nclass JSPropsUpdaterWeb implements IJSPropsUpdater {\n  public addOnJSPropsChangeListener(\n    _animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    // noop\n  }\n\n  public removeOnJSPropsChangeListener(\n    _animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    // noop\n  }\n}\n\ntype JSPropsUpdaterOptions =\n  | typeof JSPropsUpdaterWeb\n  | typeof JSPropsUpdaterFabric\n  | typeof JSPropsUpdaterPaper;\n\nlet JSPropsUpdater: JSPropsUpdaterOptions;\nif (SHOULD_BE_USE_WEB) {\n  JSPropsUpdater = JSPropsUpdaterWeb;\n} else if (global._IS_FABRIC) {\n  JSPropsUpdater = JSPropsUpdaterFabric;\n} else {\n  JSPropsUpdater = JSPropsUpdaterPaper;\n}\n\nexport default JSPropsUpdater;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}