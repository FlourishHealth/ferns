{"ast":null,"code":"'use strict';import NativeReanimatedModule from'./NativeReanimated';import{shouldBeUseWeb}from'./PlatformChecker';import{makeShareableCloneOnUIRecursive,makeShareableCloneRecursive,registerShareableMapping}from'./shareables';import{runOnUI}from'./threads';import{valueSetter}from'./valueSetter';var SHOULD_BE_USE_WEB=shouldBeUseWeb();var _worklet_12865969727780_init_data={code:\"function makeUIMutable(initial,syncDataHolder){const{valueSetter,makeShareableCloneOnUIRecursive}=this.__closure;const listeners=new Map();let value=initial;const self={set value(newValue){valueSetter(self,newValue);},get value(){return value;},set _value(newValue){value=newValue;if(syncDataHolder){_updateDataSynchronously(syncDataHolder,makeShareableCloneOnUIRecursive(newValue));}listeners.forEach(function(listener){listener(newValue);});},get _value(){return value;},modify:function(modifier){let forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;valueSetter(self,modifier!==undefined?modifier(value):value,forceUpdate);},addListener:function(id,listener){listeners.set(id,listener);},removeListener:function(id){listeners.delete(id);},_animation:null,_isReanimatedSharedValue:true};return self;}\"};export var makeUIMutable=function(){var makeUIMutable=function makeUIMutable(initial,syncDataHolder){var listeners=new Map();var value=initial;var self={set value(newValue){valueSetter(self,newValue);},get value(){return value;},set _value(newValue){value=newValue;if(syncDataHolder){_updateDataSynchronously(syncDataHolder,makeShareableCloneOnUIRecursive(newValue));}listeners.forEach(function(listener){listener(newValue);});},get _value(){return value;},modify:function modify(modifier){var forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;valueSetter(self,modifier!==undefined?modifier(value):value,forceUpdate);},addListener:function addListener(id,listener){listeners.set(id,listener);},removeListener:function removeListener(id){listeners.delete(id);},_animation:null,_isReanimatedSharedValue:true};return self;};makeUIMutable.__closure={valueSetter:valueSetter,makeShareableCloneOnUIRecursive:makeShareableCloneOnUIRecursive};makeUIMutable.__workletHash=12865969727780;makeUIMutable.__initData=_worklet_12865969727780_init_data;return makeUIMutable;}();var _worklet_12435948459793_init_data={code:\"function anonymous(){const{makeUIMutable,initial,syncDataHolder}=this.__closure;return makeUIMutable(initial,syncDataHolder);}\"};var _worklet_12096167784162_init_data={code:\"function anonymous(){const{mutable,newValue}=this.__closure;mutable.value=newValue;}\"};var _worklet_10579608795621_init_data={code:\"function anonymous(){const{mutable,modifier,forceUpdate}=this.__closure;mutable.modify(modifier,forceUpdate);}\"};export function makeMutable(initial){var oneWayReadsOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var value=initial;var syncDataHolder;if(!oneWayReadsOnly&&!SHOULD_BE_USE_WEB){syncDataHolder=NativeReanimatedModule.makeSynchronizedDataHolder(makeShareableCloneRecursive(value));registerShareableMapping(syncDataHolder);}var handle=makeShareableCloneRecursive({__init:function(){var anonymous=function anonymous(){return makeUIMutable(initial,syncDataHolder);};anonymous.__closure={makeUIMutable:makeUIMutable,initial:initial,syncDataHolder:syncDataHolder};anonymous.__workletHash=12435948459793;anonymous.__initData=_worklet_12435948459793_init_data;return anonymous;}()});var listeners=SHOULD_BE_USE_WEB?new Map():undefined;var mutable={set value(newValue){if(SHOULD_BE_USE_WEB){valueSetter(mutable,newValue);}else{runOnUI(function(){var anonymous=function anonymous(){mutable.value=newValue;};anonymous.__closure={mutable:mutable,newValue:newValue};anonymous.__workletHash=12096167784162;anonymous.__initData=_worklet_12096167784162_init_data;return anonymous;}())();}},get value(){if(syncDataHolder){return NativeReanimatedModule.getDataSynchronously(syncDataHolder);}return value;},set _value(newValue){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Setting `_value` directly is only possible on the UI runtime.');}value=newValue;listeners.forEach(function(listener){listener(newValue);});},get _value(){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Reading from `_value` directly is only possible on the UI runtime.');}return value;},modify:function modify(modifier){var forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!SHOULD_BE_USE_WEB){runOnUI(function(){var anonymous=function anonymous(){mutable.modify(modifier,forceUpdate);};anonymous.__closure={mutable:mutable,modifier:modifier,forceUpdate:forceUpdate};anonymous.__workletHash=10579608795621;anonymous.__initData=_worklet_10579608795621_init_data;return anonymous;}())();}else{valueSetter(mutable,modifier!==undefined?modifier(mutable.value):mutable.value,forceUpdate);}},addListener:function addListener(id,listener){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Adding listeners is only possible on the UI runtime.');}listeners.set(id,listener);},removeListener:function removeListener(id){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Removing listeners is only possible on the UI runtime.');}listeners.delete(id);},_isReanimatedSharedValue:true};registerShareableMapping(mutable,handle);return mutable;}var _worklet_11709675973052_init_data={code:\"function anonymous(){const{initial}=this.__closure;return initial;}\"};export function makeRemote(){var initial=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var handle=makeShareableCloneRecursive({__init:function(){var anonymous=function anonymous(){return initial;};anonymous.__closure={initial:initial};anonymous.__workletHash=11709675973052;anonymous.__initData=_worklet_11709675973052_init_data;return anonymous;}()});registerShareableMapping(initial,handle);return initial;}","map":{"version":3,"sources":["mutables.ts"],"names":["NativeReanimatedModule","shouldBeUseWeb","makeShareableCloneOnUIRecursive","makeShareableCloneRecursive","registerShareableMapping","runOnUI","valueSetter","SHOULD_BE_USE_WEB","makeUIMutable","initial","syncDataHolder","listeners","Map","value","self","newValue","_value","_updateDataSynchronously","forEach","listener","modify","modifier","forceUpdate","undefined","addListener","id","set","removeListener","delete","_animation","_isReanimatedSharedValue","makeMutable","oneWayReadsOnly","makeSynchronizedDataHolder","handle","__init","mutable","getDataSynchronously","Error","makeRemote"],"mappings":"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","sourcesContent":["'use strict';\nimport NativeReanimatedModule from './NativeReanimated';\nimport { shouldBeUseWeb } from './PlatformChecker';\nimport type { SharedValue, ShareableSyncDataHolderRef } from './commonTypes';\nimport {\n  makeShareableCloneOnUIRecursive,\n  makeShareableCloneRecursive,\n  registerShareableMapping,\n} from './shareables';\nimport { runOnUI } from './threads';\nimport { valueSetter } from './valueSetter';\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\nexport function makeUIMutable<T>(\n  initial: T,\n  syncDataHolder?: ShareableSyncDataHolderRef<T>\n) {\n  'worklet';\n\n  const listeners = new Map();\n  let value = initial;\n\n  const self = {\n    set value(newValue) {\n      valueSetter(self, newValue);\n    },\n    get value() {\n      return value;\n    },\n    /**\n     * _value prop should only be accessed by the valueSetter implementation\n     * which may make the decision about updating the mutable value depending\n     * on the provided new value. All other places should only attempt to modify\n     * the mutable by assigning to value prop directly.\n     */\n    set _value(newValue: T) {\n      value = newValue;\n      if (syncDataHolder) {\n        _updateDataSynchronously(\n          syncDataHolder,\n          makeShareableCloneOnUIRecursive(newValue)\n        );\n      }\n      listeners.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n    get _value(): T {\n      return value;\n    },\n    modify: (modifier?: (value: T) => T, forceUpdate = true) => {\n      valueSetter(\n        self,\n        modifier !== undefined ? modifier(value) : value,\n        forceUpdate\n      );\n    },\n    addListener: (id: number, listener: (newValue: T) => void) => {\n      listeners.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      listeners.delete(id);\n    },\n    _animation: null,\n    _isReanimatedSharedValue: true,\n  };\n  return self;\n}\n\nexport function makeMutable<T>(\n  initial: T,\n  oneWayReadsOnly = false\n): SharedValue<T> {\n  let value: T = initial;\n  let syncDataHolder: ShareableSyncDataHolderRef<T> | undefined;\n  if (!oneWayReadsOnly && !SHOULD_BE_USE_WEB) {\n    // updates are always synchronous when running on web or in Jest environment\n    syncDataHolder = NativeReanimatedModule.makeSynchronizedDataHolder(\n      makeShareableCloneRecursive(value)\n    );\n    registerShareableMapping(syncDataHolder);\n  }\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return makeUIMutable(initial, syncDataHolder);\n    },\n  });\n  // listeners can only work on JS thread on Web and jest environments\n  const listeners = SHOULD_BE_USE_WEB ? new Map() : undefined;\n  const mutable = {\n    set value(newValue) {\n      if (SHOULD_BE_USE_WEB) {\n        valueSetter(mutable, newValue);\n      } else {\n        runOnUI(() => {\n          mutable.value = newValue;\n        })();\n      }\n    },\n    get value() {\n      if (syncDataHolder) {\n        return NativeReanimatedModule.getDataSynchronously(syncDataHolder);\n      }\n      return value;\n    },\n    set _value(newValue: T) {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Setting `_value` directly is only possible on the UI runtime.'\n        );\n      }\n      value = newValue;\n      listeners!.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n    get _value(): T {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Reading from `_value` directly is only possible on the UI runtime.'\n        );\n      }\n      return value;\n    },\n    modify: (modifier?: (value: T) => T, forceUpdate = true) => {\n      if (!SHOULD_BE_USE_WEB) {\n        runOnUI(() => {\n          mutable.modify(modifier, forceUpdate);\n        })();\n      } else {\n        valueSetter(\n          mutable,\n          modifier !== undefined ? modifier(mutable.value) : mutable.value,\n          forceUpdate\n        );\n      }\n    },\n    addListener: (id: number, listener: (value: T) => void) => {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Adding listeners is only possible on the UI runtime.'\n        );\n      }\n      listeners!.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Removing listeners is only possible on the UI runtime.'\n        );\n      }\n      listeners!.delete(id);\n    },\n    _isReanimatedSharedValue: true,\n  };\n  registerShareableMapping(mutable, handle);\n  return mutable;\n}\n\nexport function makeRemote<T extends object>(initial: T = {} as T): T {\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return initial;\n    },\n  });\n  registerShareableMapping(initial, handle);\n  return initial;\n}\n"]},"metadata":{},"sourceType":"module"}