{"ast":null,"code":"'use strict';import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import NativeReanimatedModule from'./NativeReanimated';import{isJest,shouldBeUseWeb}from'./PlatformChecker';import{makeShareableCloneOnUIRecursive,makeShareableCloneRecursive}from'./shareables';var IS_JEST=isJest();var SHOULD_BE_USE_WEB=shouldBeUseWeb();var _runOnUIQueue=[];var _worklet_14171424909649_init_data={code:\"function setupMicrotasks(){let microtasksQueue=[];let isExecutingMicrotasksQueue=false;global.queueMicrotask=function(callback){microtasksQueue.push(callback);};global.__callMicrotasks=function(){if(isExecutingMicrotasksQueue){return;}try{isExecutingMicrotasksQueue=true;for(let index=0;index<microtasksQueue.length;index+=1){microtasksQueue[index]();}microtasksQueue=[];global._maybeFlushUIUpdatesQueue();}finally{isExecutingMicrotasksQueue=false;}};}\"};export var setupMicrotasks=function(){var setupMicrotasks=function setupMicrotasks(){var microtasksQueue=[];var isExecutingMicrotasksQueue=false;global.queueMicrotask=function(callback){microtasksQueue.push(callback);};global.__callMicrotasks=function(){if(isExecutingMicrotasksQueue){return;}try{isExecutingMicrotasksQueue=true;for(var index=0;index<microtasksQueue.length;index+=1){microtasksQueue[index]();}microtasksQueue=[];global._maybeFlushUIUpdatesQueue();}finally{isExecutingMicrotasksQueue=false;}};};setupMicrotasks.__closure={};setupMicrotasks.__workletHash=14171424909649;setupMicrotasks.__initData=_worklet_14171424909649_init_data;return setupMicrotasks;}();var _worklet_3679683358222_init_data={code:\"function callMicrotasksOnUIThread(){global.__callMicrotasks();}\"};var callMicrotasksOnUIThread=function(){var callMicrotasksOnUIThread=function callMicrotasksOnUIThread(){global.__callMicrotasks();};callMicrotasksOnUIThread.__closure={};callMicrotasksOnUIThread.__workletHash=3679683358222;callMicrotasksOnUIThread.__initData=_worklet_3679683358222_init_data;return callMicrotasksOnUIThread;}();export var callMicrotasks=SHOULD_BE_USE_WEB?function(){}:callMicrotasksOnUIThread;var _worklet_1184663255910_init_data={code:\"function runOnUI(worklet){const{__DEV__,SHOULD_BE_USE_WEB,IS_JEST,NativeReanimatedModule,makeShareableCloneRecursive,callMicrotasks}=this.__closure;if(__DEV__&&!SHOULD_BE_USE_WEB&&_WORKLET){throw new Error('[Reanimated] `runOnUI` cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.');}if(__DEV__&&!SHOULD_BE_USE_WEB&&worklet.__workletHash===undefined){throw new Error('[Reanimated] `runOnUI` can only be used on worklets.');}return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}if(IS_JEST){NativeReanimatedModule.scheduleOnUI(makeShareableCloneRecursive(function(){'worklet';worklet(...args);}));return;}if(__DEV__){makeShareableCloneRecursive(worklet);makeShareableCloneRecursive(args);}_runOnUIQueue.push([worklet,args]);if(_runOnUIQueue.length===1){queueMicrotask(function(){const queue=_runOnUIQueue;_runOnUIQueue=[];NativeReanimatedModule.scheduleOnUI(makeShareableCloneRecursive(function(){'worklet';queue.forEach(function(_ref){let[worklet,args]=_ref;worklet(...args);});callMicrotasks();}));});}};}\"};var _worklet_6225829938965_init_data={code:\"function anonymous(){const{worklet,args}=this.__closure;worklet(...args);}\"};var _worklet_13068487485531_init_data={code:\"function anonymous(){const{queue,callMicrotasks}=this.__closure;queue.forEach(function(_ref){let[worklet,args]=_ref;worklet(...args);});callMicrotasks();}\"};export var runOnUI=function(){var runOnUI=function runOnUI(worklet){if(false&&!SHOULD_BE_USE_WEB&&_WORKLET){throw new Error('[Reanimated] `runOnUI` cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.');}if(false&&!SHOULD_BE_USE_WEB&&worklet.__workletHash===undefined){throw new Error('[Reanimated] `runOnUI` can only be used on worklets.');}return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}if(IS_JEST){NativeReanimatedModule.scheduleOnUI(makeShareableCloneRecursive(function(){var anonymous=function anonymous(){worklet.apply(void 0,args);};anonymous.__closure={worklet:worklet,args:args};anonymous.__workletHash=6225829938965;anonymous.__initData=_worklet_6225829938965_init_data;return anonymous;}()));return;}if(false){makeShareableCloneRecursive(worklet);makeShareableCloneRecursive(args);}_runOnUIQueue.push([worklet,args]);if(_runOnUIQueue.length===1){queueMicrotask(function(){var queue=_runOnUIQueue;_runOnUIQueue=[];NativeReanimatedModule.scheduleOnUI(makeShareableCloneRecursive(function(){var anonymous=function anonymous(){queue.forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),worklet=_ref2[0],args=_ref2[1];worklet.apply(void 0,_toConsumableArray(args));});callMicrotasks();};anonymous.__closure={queue:queue,callMicrotasks:callMicrotasks};anonymous.__workletHash=13068487485531;anonymous.__initData=_worklet_13068487485531_init_data;return anonymous;}()));});}};};runOnUI.__closure={__DEV__:false,SHOULD_BE_USE_WEB:SHOULD_BE_USE_WEB,IS_JEST:IS_JEST,NativeReanimatedModule:NativeReanimatedModule,makeShareableCloneRecursive:makeShareableCloneRecursive,callMicrotasks:callMicrotasks};runOnUI.__workletHash=1184663255910;runOnUI.__initData=_worklet_1184663255910_init_data;return runOnUI;}();var _worklet_10117741488730_init_data={code:\"function runOnUIImmediately(worklet){const{__DEV__,SHOULD_BE_USE_WEB,NativeReanimatedModule,makeShareableCloneRecursive}=this.__closure;if(__DEV__&&!SHOULD_BE_USE_WEB&&_WORKLET){throw new Error('[Reanimated] `runOnUIImmediately` cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.');}if(__DEV__&&!SHOULD_BE_USE_WEB&&worklet.__workletHash===undefined){throw new Error('[Reanimated] `runOnUIImmediately` can only be used on worklets.');}return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}NativeReanimatedModule.scheduleOnUI(makeShareableCloneRecursive(function(){'worklet';worklet(...args);}));};}\"};var _worklet_6225829938965_init_data2={code:\"function anonymous(){const{worklet,args}=this.__closure;worklet(...args);}\"};export var runOnUIImmediately=function(){var runOnUIImmediately=function runOnUIImmediately(worklet){if(false&&!SHOULD_BE_USE_WEB&&_WORKLET){throw new Error('[Reanimated] `runOnUIImmediately` cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.');}if(false&&!SHOULD_BE_USE_WEB&&worklet.__workletHash===undefined){throw new Error('[Reanimated] `runOnUIImmediately` can only be used on worklets.');}return function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}NativeReanimatedModule.scheduleOnUI(makeShareableCloneRecursive(function(){var anonymous=function anonymous(){worklet.apply(void 0,args);};anonymous.__closure={worklet:worklet,args:args};anonymous.__workletHash=6225829938965;anonymous.__initData=_worklet_6225829938965_init_data2;return anonymous;}()));};};runOnUIImmediately.__closure={__DEV__:false,SHOULD_BE_USE_WEB:SHOULD_BE_USE_WEB,NativeReanimatedModule:NativeReanimatedModule,makeShareableCloneRecursive:makeShareableCloneRecursive};runOnUIImmediately.__workletHash=10117741488730;runOnUIImmediately.__initData=_worklet_10117741488730_init_data;return runOnUIImmediately;}();function runWorkletOnJS(worklet){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3];}worklet.apply(void 0,args);}var _worklet_12681577252125_init_data={code:\"function runOnJS(fun){const runOnJS=this._recur;const{SHOULD_BE_USE_WEB,runWorkletOnJS,makeShareableCloneOnUIRecursive}=this.__closure;if(SHOULD_BE_USE_WEB||!_WORKLET){return function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4];}return queueMicrotask(args.length?function(){return fun(...args);}:fun);};}if(fun.__workletHash){return function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5];}return runOnJS(runWorkletOnJS)(fun,...args);};}if(fun.__remoteFunction){fun=fun.__remoteFunction;}return function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}_scheduleOnJS(fun,args.length>0?makeShareableCloneOnUIRecursive(args):undefined);};}\"};export var runOnJS=function(){var runOnJS=function runOnJS(fun){if(SHOULD_BE_USE_WEB||!_WORKLET){return function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4];}return queueMicrotask(args.length?function(){return fun.apply(void 0,args);}:fun);};}if(fun.__workletHash){return function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5];}return runOnJS(runWorkletOnJS).apply(void 0,[fun].concat(args));};}if(fun.__remoteFunction){fun=fun.__remoteFunction;}return function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}_scheduleOnJS(fun,args.length>0?makeShareableCloneOnUIRecursive(args):undefined);};};runOnJS.__closure={SHOULD_BE_USE_WEB:SHOULD_BE_USE_WEB,runWorkletOnJS:runWorkletOnJS,makeShareableCloneOnUIRecursive:makeShareableCloneOnUIRecursive};runOnJS.__workletHash=12681577252125;runOnJS.__initData=_worklet_12681577252125_init_data;return runOnJS;}();","map":{"version":3,"sources":["threads.ts"],"names":["NativeReanimatedModule","isJest","shouldBeUseWeb","makeShareableCloneOnUIRecursive","makeShareableCloneRecursive","IS_JEST","SHOULD_BE_USE_WEB","_runOnUIQueue","setupMicrotasks","microtasksQueue","isExecutingMicrotasksQueue","global","queueMicrotask","callback","push","__callMicrotasks","index","length","_maybeFlushUIUpdatesQueue","callMicrotasksOnUIThread","callMicrotasks","runOnUI","worklet","__DEV__","_WORKLET","Error","__workletHash","undefined","args","scheduleOnUI","queue","forEach","_ref","runOnUIImmediately","runWorkletOnJS","runOnJS","fun","__remoteFunction","_scheduleOnJS"],"mappings":"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","sourcesContent":["'use strict';\nimport NativeReanimatedModule from './NativeReanimated';\nimport { isJest, shouldBeUseWeb } from './PlatformChecker';\nimport type { WorkletFunction } from './commonTypes';\nimport {\n  makeShareableCloneOnUIRecursive,\n  makeShareableCloneRecursive,\n} from './shareables';\n\nconst IS_JEST = isJest();\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\n/**\n * An array of [worklet, args] pairs.\n * */\nlet _runOnUIQueue: Array<[WorkletFunction<unknown[], unknown>, unknown[]]> = [];\n\nexport function setupMicrotasks() {\n  'worklet';\n\n  let microtasksQueue: Array<() => void> = [];\n  let isExecutingMicrotasksQueue = false;\n  global.queueMicrotask = (callback: () => void) => {\n    microtasksQueue.push(callback);\n  };\n\n  global.__callMicrotasks = () => {\n    if (isExecutingMicrotasksQueue) {\n      return;\n    }\n    try {\n      isExecutingMicrotasksQueue = true;\n      for (let index = 0; index < microtasksQueue.length; index += 1) {\n        // we use classic 'for' loop because the size of the currentTasks array may change while executing some of the callbacks due to queueMicrotask calls\n        microtasksQueue[index]();\n      }\n      microtasksQueue = [];\n      global._maybeFlushUIUpdatesQueue();\n    } finally {\n      isExecutingMicrotasksQueue = false;\n    }\n  };\n}\n\nfunction callMicrotasksOnUIThread() {\n  'worklet';\n  global.__callMicrotasks();\n}\n\nexport const callMicrotasks = SHOULD_BE_USE_WEB\n  ? () => {\n      // on web flushing is a noop as immediates are handled by the browser\n    }\n  : callMicrotasksOnUIThread;\n\n/**\n * Lets you asynchronously run [workletized](https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary#to-workletize) functions on the [UI thread](https://docs.swmansion.com/react-native-reanimated/docs/threading/runOnUI).\n *\n * This method does not schedule the work immediately but instead waits for other worklets\n * to be scheduled within the same JS loop. It uses queueMicrotask to schedule all the worklets\n * at once making sure they will run within the same frame boundaries on the UI thread.\n *\n * @param fun - A reference to a function you want to execute on the [UI thread](https://docs.swmansion.com/react-native-reanimated/docs/threading/runOnUI) from the [JavaScript thread](https://docs.swmansion.com/react-native-reanimated/docs/threading/runOnUI).\n * @returns A function that accepts arguments for the function passed as the first argument.\n * @see https://docs.swmansion.com/react-native-reanimated/docs/threading/runOnUI\n */\n// @ts-expect-error This overload is correct since it's what user sees in his code\n// before it's transformed by Reanimated Babel plugin.\nexport function runOnUI<Args extends unknown[], ReturnValue>(\n  worklet: (...args: Args) => ReturnValue\n): (...args: Args) => void;\n\nexport function runOnUI<Args extends unknown[], ReturnValue>(\n  worklet: WorkletFunction<Args, ReturnValue>\n): (...args: Args) => void {\n  'worklet';\n  if (__DEV__ && !SHOULD_BE_USE_WEB && _WORKLET) {\n    throw new Error(\n      '[Reanimated] `runOnUI` cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.'\n    );\n  }\n  if (__DEV__ && !SHOULD_BE_USE_WEB && worklet.__workletHash === undefined) {\n    throw new Error('[Reanimated] `runOnUI` can only be used on worklets.');\n  }\n  return (...args) => {\n    if (IS_JEST) {\n      // Mocking time in Jest is tricky as both requestAnimationFrame and queueMicrotask\n      // callbacks run on the same queue and can be interleaved. There is no way\n      // to flush particular queue in Jest and the only control over mocked timers\n      // is by using jest.advanceTimersByTime() method which advances all types\n      // of timers including immediate and animation callbacks. Ideally we'd like\n      // to have some way here to schedule work along with React updates, but\n      // that's not possible, and hence in Jest environment instead of using scheduling\n      // mechanism we just schedule the work ommiting the queue. This is ok for the\n      // uses that we currently have but may not be ok for future tests that we write.\n      NativeReanimatedModule.scheduleOnUI(\n        makeShareableCloneRecursive(() => {\n          'worklet';\n          worklet(...args);\n        })\n      );\n      return;\n    }\n    if (__DEV__) {\n      // in DEV mode we call shareable conversion here because in case the object\n      // can't be converted, we will get a meaningful stack-trace as opposed to the\n      // situation when conversion is only done via microtask queue. This does not\n      // make the app particularily less efficient as converted objects are cached\n      // and for a given worklet the conversion only happens once.\n      makeShareableCloneRecursive(worklet);\n      makeShareableCloneRecursive(args);\n    }\n    //\n    _runOnUIQueue.push([worklet as WorkletFunction<unknown[], unknown>, args]);\n    if (_runOnUIQueue.length === 1) {\n      queueMicrotask(() => {\n        const queue = _runOnUIQueue;\n        _runOnUIQueue = [];\n        NativeReanimatedModule.scheduleOnUI(\n          makeShareableCloneRecursive(() => {\n            'worklet';\n            queue.forEach(([worklet, args]) => {\n              worklet(...args);\n            });\n            callMicrotasks();\n          })\n        );\n      });\n    }\n  };\n}\n\n// @ts-expect-error Check `runOnUI` overload above.\nexport function runOnUIImmediately<Args extends unknown[], ReturnValue>(\n  worklet: (...args: Args) => ReturnValue\n): WorkletFunction<Args, ReturnValue>;\n/**\n * Schedule a worklet to execute on the UI runtime skipping batching mechanism.\n */\nexport function runOnUIImmediately<Args extends unknown[], ReturnValue>(\n  worklet: WorkletFunction<Args, ReturnValue>\n): (...args: Args) => void {\n  'worklet';\n  if (__DEV__ && !SHOULD_BE_USE_WEB && _WORKLET) {\n    throw new Error(\n      '[Reanimated] `runOnUIImmediately` cannot be called on the UI runtime. Please call the function synchronously or use `queueMicrotask` or `requestAnimationFrame` instead.'\n    );\n  }\n  if (__DEV__ && !SHOULD_BE_USE_WEB && worklet.__workletHash === undefined) {\n    throw new Error(\n      '[Reanimated] `runOnUIImmediately` can only be used on worklets.'\n    );\n  }\n  return (...args) => {\n    NativeReanimatedModule.scheduleOnUI(\n      makeShareableCloneRecursive(() => {\n        'worklet';\n        worklet(...args);\n      })\n    );\n  };\n}\n\ntype ReleaseRemoteFunction<Args extends unknown[], ReturnValue> = {\n  (...args: Args): ReturnValue;\n};\n\ntype DevRemoteFunction<Args extends unknown[], ReturnValue> = {\n  __remoteFunction: (...args: Args) => ReturnValue;\n};\n\ntype RemoteFunction<Args extends unknown[], ReturnValue> =\n  | ReleaseRemoteFunction<Args, ReturnValue>\n  | DevRemoteFunction<Args, ReturnValue>;\n\nfunction runWorkletOnJS<Args extends unknown[], ReturnValue>(\n  worklet: WorkletFunction<Args, ReturnValue>,\n  ...args: Args\n): void {\n  // remote function that calls a worklet synchronously on the JS runtime\n  worklet(...args);\n}\n\n/**\n * Lets you asynchronously run non-[workletized](https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary#to-workletize) functions that couldn't otherwise run on the [UI thread](https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary#ui-thread).\n * This applies to most external libraries as they don't have their functions marked with \"worklet\"; directive.\n *\n * @param fun - A reference to a function you want to execute on the JavaScript thread from the UI thread.\n * @returns A function that accepts arguments for the function passed as the first argument.\n * @see https://docs.swmansion.com/react-native-reanimated/docs/threading/runOnJS\n */\nexport function runOnJS<Args extends unknown[], ReturnValue>(\n  fun:\n    | ((...args: Args) => ReturnValue)\n    | RemoteFunction<Args, ReturnValue>\n    | WorkletFunction<Args, ReturnValue>\n): (...args: Args) => void {\n  'worklet';\n  type FunWorklet = Extract<typeof fun, WorkletFunction<Args, ReturnValue>>;\n  type FunDevRemote = Extract<typeof fun, DevRemoteFunction<Args, ReturnValue>>;\n  if (SHOULD_BE_USE_WEB || !_WORKLET) {\n    // if we are already on the JS thread, we just schedule the worklet on the JS queue\n    return (...args) =>\n      queueMicrotask(\n        args.length\n          ? () => (fun as (...args: Args) => ReturnValue)(...args)\n          : (fun as () => ReturnValue)\n      );\n  }\n  if ((fun as FunWorklet).__workletHash) {\n    // If `fun` is a worklet, we schedule a call of a remote function `runWorkletOnJS`\n    // and pass the worklet as a first argument followed by original arguments.\n\n    return (...args) =>\n      runOnJS(runWorkletOnJS<Args, ReturnValue>)(\n        fun as WorkletFunction<Args, ReturnValue>,\n        ...args\n      );\n  }\n  if ((fun as FunDevRemote).__remoteFunction) {\n    // In development mode the function provided as `fun` throws an error message\n    // such that when someone accidentally calls it directly on the UI runtime, they\n    // see that they should use `runOnJS` instead. To facilitate that we put the\n    // reference to the original remote function in the `__functionInDEV` property.\n    fun = (fun as FunDevRemote).__remoteFunction;\n  }\n  return (...args) => {\n    _scheduleOnJS(\n      fun as\n        | ((...args: Args) => ReturnValue)\n        | WorkletFunction<Args, ReturnValue>,\n      args.length > 0\n        ? // TODO TYPESCRIPT this cast is terrible but will be fixed\n          (makeShareableCloneOnUIRecursive(args) as unknown as unknown[])\n        : undefined\n    );\n  };\n}\n"]},"metadata":{},"sourceType":"module"}