{"ast":null,"code":"'use strict';import NativeReanimatedModule from'./NativeReanimated';import{shouldBeUseWeb}from'./PlatformChecker';import{makeShareableCloneOnUIRecursive,makeShareableCloneRecursive,registerShareableMapping}from'./shareables';import{runOnUI}from'./threads';import{valueSetter}from'./valueSetter';var SHOULD_BE_USE_WEB=shouldBeUseWeb();var _worklet_12865969727780_init_data={code:\"function makeUIMutable(initial,syncDataHolder){const{valueSetter,makeShareableCloneOnUIRecursive}=this.__closure;const listeners=new Map();let value=initial;const self={set value(newValue){valueSetter(self,newValue);},get value(){return value;},set _value(newValue){value=newValue;if(syncDataHolder){_updateDataSynchronously(syncDataHolder,makeShareableCloneOnUIRecursive(newValue));}listeners.forEach(function(listener){listener(newValue);});},get _value(){return value;},modify:function(modifier){let forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;valueSetter(self,modifier!==undefined?modifier(value):value,forceUpdate);},addListener:function(id,listener){listeners.set(id,listener);},removeListener:function(id){listeners.delete(id);},_animation:null,_isReanimatedSharedValue:true};return self;}\"};export var makeUIMutable=function(){var makeUIMutable=function makeUIMutable(initial,syncDataHolder){var listeners=new Map();var value=initial;var self={set value(newValue){valueSetter(self,newValue);},get value(){return value;},set _value(newValue){value=newValue;if(syncDataHolder){_updateDataSynchronously(syncDataHolder,makeShareableCloneOnUIRecursive(newValue));}listeners.forEach(function(listener){listener(newValue);});},get _value(){return value;},modify:function modify(modifier){var forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;valueSetter(self,modifier!==undefined?modifier(value):value,forceUpdate);},addListener:function addListener(id,listener){listeners.set(id,listener);},removeListener:function removeListener(id){listeners.delete(id);},_animation:null,_isReanimatedSharedValue:true};return self;};makeUIMutable.__closure={valueSetter:valueSetter,makeShareableCloneOnUIRecursive:makeShareableCloneOnUIRecursive};makeUIMutable.__workletHash=12865969727780;makeUIMutable.__initData=_worklet_12865969727780_init_data;return makeUIMutable;}();var _worklet_12435948459793_init_data={code:\"function anonymous(){const{makeUIMutable,initial,syncDataHolder}=this.__closure;return makeUIMutable(initial,syncDataHolder);}\"};var _worklet_12096167784162_init_data={code:\"function anonymous(){const{mutable,newValue}=this.__closure;mutable.value=newValue;}\"};var _worklet_10579608795621_init_data={code:\"function anonymous(){const{mutable,modifier,forceUpdate}=this.__closure;mutable.modify(modifier,forceUpdate);}\"};export function makeMutable(initial){var oneWayReadsOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var value=initial;var syncDataHolder;if(!oneWayReadsOnly&&!SHOULD_BE_USE_WEB){syncDataHolder=NativeReanimatedModule.makeSynchronizedDataHolder(makeShareableCloneRecursive(value));registerShareableMapping(syncDataHolder);}var handle=makeShareableCloneRecursive({__init:function(){var anonymous=function anonymous(){return makeUIMutable(initial,syncDataHolder);};anonymous.__closure={makeUIMutable:makeUIMutable,initial:initial,syncDataHolder:syncDataHolder};anonymous.__workletHash=12435948459793;anonymous.__initData=_worklet_12435948459793_init_data;return anonymous;}()});var listeners=SHOULD_BE_USE_WEB?new Map():undefined;var mutable={set value(newValue){if(SHOULD_BE_USE_WEB){valueSetter(mutable,newValue);}else{runOnUI(function(){var anonymous=function anonymous(){mutable.value=newValue;};anonymous.__closure={mutable:mutable,newValue:newValue};anonymous.__workletHash=12096167784162;anonymous.__initData=_worklet_12096167784162_init_data;return anonymous;}())();}},get value(){if(syncDataHolder){return NativeReanimatedModule.getDataSynchronously(syncDataHolder);}return value;},set _value(newValue){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Setting `_value` directly is only possible on the UI runtime.');}value=newValue;listeners.forEach(function(listener){listener(newValue);});},get _value(){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Reading from `_value` directly is only possible on the UI runtime.');}return value;},modify:function modify(modifier){var forceUpdate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!SHOULD_BE_USE_WEB){runOnUI(function(){var anonymous=function anonymous(){mutable.modify(modifier,forceUpdate);};anonymous.__closure={mutable:mutable,modifier:modifier,forceUpdate:forceUpdate};anonymous.__workletHash=10579608795621;anonymous.__initData=_worklet_10579608795621_init_data;return anonymous;}())();}else{valueSetter(mutable,modifier!==undefined?modifier(mutable.value):mutable.value,forceUpdate);}},addListener:function addListener(id,listener){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Adding listeners is only possible on the UI runtime.');}listeners.set(id,listener);},removeListener:function removeListener(id){if(!SHOULD_BE_USE_WEB){throw new Error('[Reanimated] Removing listeners is only possible on the UI runtime.');}listeners.delete(id);},_isReanimatedSharedValue:true};registerShareableMapping(mutable,handle);return mutable;}var _worklet_11709675973052_init_data={code:\"function anonymous(){const{initial}=this.__closure;return initial;}\"};export function makeRemote(){var initial=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var handle=makeShareableCloneRecursive({__init:function(){var anonymous=function anonymous(){return initial;};anonymous.__closure={initial:initial};anonymous.__workletHash=11709675973052;anonymous.__initData=_worklet_11709675973052_init_data;return anonymous;}()});registerShareableMapping(initial,handle);return initial;}","map":{"version":3,"names":["NativeReanimatedModule","shouldBeUseWeb","makeShareableCloneOnUIRecursive","makeShareableCloneRecursive","registerShareableMapping","runOnUI","valueSetter","SHOULD_BE_USE_WEB","_worklet_12865969727780_init_data","code","makeUIMutable","initial","syncDataHolder","listeners","Map","value","self","newValue","_value","_updateDataSynchronously","forEach","listener","modify","modifier","forceUpdate","arguments","length","undefined","addListener","id","set","removeListener","delete","_animation","_isReanimatedSharedValue","__closure","__workletHash","__initData","_worklet_12435948459793_init_data","_worklet_12096167784162_init_data","_worklet_10579608795621_init_data","makeMutable","oneWayReadsOnly","makeSynchronizedDataHolder","handle","__init","anonymous","mutable","getDataSynchronously","Error","_worklet_11709675973052_init_data","makeRemote"],"sources":["/Users/josh/src/ui/node_modules/react-native-reanimated/lib/module/reanimated2/mutables.ts"],"sourcesContent":["'use strict';\nimport NativeReanimatedModule from './NativeReanimated';\nimport { shouldBeUseWeb } from './PlatformChecker';\nimport type { SharedValue, ShareableSyncDataHolderRef } from './commonTypes';\nimport {\n  makeShareableCloneOnUIRecursive,\n  makeShareableCloneRecursive,\n  registerShareableMapping,\n} from './shareables';\nimport { runOnUI } from './threads';\nimport { valueSetter } from './valueSetter';\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\nexport function makeUIMutable<T>(\n  initial: T,\n  syncDataHolder?: ShareableSyncDataHolderRef<T>\n) {\n  'worklet';\n\n  const listeners = new Map();\n  let value = initial;\n\n  const self = {\n    set value(newValue) {\n      valueSetter(self, newValue);\n    },\n    get value() {\n      return value;\n    },\n    /**\n     * _value prop should only be accessed by the valueSetter implementation\n     * which may make the decision about updating the mutable value depending\n     * on the provided new value. All other places should only attempt to modify\n     * the mutable by assigning to value prop directly.\n     */\n    set _value(newValue: T) {\n      value = newValue;\n      if (syncDataHolder) {\n        _updateDataSynchronously(\n          syncDataHolder,\n          makeShareableCloneOnUIRecursive(newValue)\n        );\n      }\n      listeners.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n    get _value(): T {\n      return value;\n    },\n    modify: (modifier?: (value: T) => T, forceUpdate = true) => {\n      valueSetter(\n        self,\n        modifier !== undefined ? modifier(value) : value,\n        forceUpdate\n      );\n    },\n    addListener: (id: number, listener: (newValue: T) => void) => {\n      listeners.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      listeners.delete(id);\n    },\n    _animation: null,\n    _isReanimatedSharedValue: true,\n  };\n  return self;\n}\n\nexport function makeMutable<T>(\n  initial: T,\n  oneWayReadsOnly = false\n): SharedValue<T> {\n  let value: T = initial;\n  let syncDataHolder: ShareableSyncDataHolderRef<T> | undefined;\n  if (!oneWayReadsOnly && !SHOULD_BE_USE_WEB) {\n    // updates are always synchronous when running on web or in Jest environment\n    syncDataHolder = NativeReanimatedModule.makeSynchronizedDataHolder(\n      makeShareableCloneRecursive(value)\n    );\n    registerShareableMapping(syncDataHolder);\n  }\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return makeUIMutable(initial, syncDataHolder);\n    },\n  });\n  // listeners can only work on JS thread on Web and jest environments\n  const listeners = SHOULD_BE_USE_WEB ? new Map() : undefined;\n  const mutable = {\n    set value(newValue) {\n      if (SHOULD_BE_USE_WEB) {\n        valueSetter(mutable, newValue);\n      } else {\n        runOnUI(() => {\n          mutable.value = newValue;\n        })();\n      }\n    },\n    get value() {\n      if (syncDataHolder) {\n        return NativeReanimatedModule.getDataSynchronously(syncDataHolder);\n      }\n      return value;\n    },\n    set _value(newValue: T) {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Setting `_value` directly is only possible on the UI runtime.'\n        );\n      }\n      value = newValue;\n      listeners!.forEach((listener) => {\n        listener(newValue);\n      });\n    },\n    get _value(): T {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Reading from `_value` directly is only possible on the UI runtime.'\n        );\n      }\n      return value;\n    },\n    modify: (modifier?: (value: T) => T, forceUpdate = true) => {\n      if (!SHOULD_BE_USE_WEB) {\n        runOnUI(() => {\n          mutable.modify(modifier, forceUpdate);\n        })();\n      } else {\n        valueSetter(\n          mutable,\n          modifier !== undefined ? modifier(mutable.value) : mutable.value,\n          forceUpdate\n        );\n      }\n    },\n    addListener: (id: number, listener: (value: T) => void) => {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Adding listeners is only possible on the UI runtime.'\n        );\n      }\n      listeners!.set(id, listener);\n    },\n    removeListener: (id: number) => {\n      if (!SHOULD_BE_USE_WEB) {\n        throw new Error(\n          '[Reanimated] Removing listeners is only possible on the UI runtime.'\n        );\n      }\n      listeners!.delete(id);\n    },\n    _isReanimatedSharedValue: true,\n  };\n  registerShareableMapping(mutable, handle);\n  return mutable;\n}\n\nexport function makeRemote<T extends object>(initial: T = {} as T): T {\n  const handle = makeShareableCloneRecursive({\n    __init: () => {\n      'worklet';\n      return initial;\n    },\n  });\n  registerShareableMapping(initial, handle);\n  return initial;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}