{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var _Reanimated$default$c,_Reanimated$default;import React,{useContext,useEffect,useRef,useState}from'react';import{BaseGesture,CALLBACK_TYPE}from'./gesture';import{Reanimated}from'./reanimatedWrapper';import{registerHandler,unregisterHandler}from'../handlersRegistry';import RNGestureHandlerModule from'../../RNGestureHandlerModule';import{baseGestureHandlerWithMonitorProps,filterConfig,findNodeHandle,scheduleFlushOperations}from'../gestureHandlerCommon';import{GestureStateManager}from'./gestureStateManager';import{flingGestureHandlerProps}from'../FlingGestureHandler';import{forceTouchGestureHandlerProps}from'../ForceTouchGestureHandler';import{longPressGestureHandlerProps}from'../LongPressGestureHandler';import{panGestureHandlerProps,panGestureHandlerCustomNativeProps}from'../PanGestureHandler';import{tapGestureHandlerProps}from'../TapGestureHandler';import{hoverGestureHandlerProps}from'./hoverGesture';import{State}from'../../State';import{TouchEventType}from'../../TouchEventType';import{ActionType}from'../../ActionType';import{isFabric,isJestEnv,tagMessage}from'../../utils';import{getReactNativeVersion}from'../../getReactNativeVersion';import{getShadowNodeFromRef}from'../../getShadowNodeFromRef';import Platform from\"react-native-web/dist/exports/Platform\";import{onGestureHandlerEvent as _onGestureHandlerEvent}from'./eventReceiver';import{RNRenderer}from'../../RNRenderer';import{isNewWebImplementationEnabled}from'../../EnableNewWebImplementation';import{nativeViewGestureHandlerProps}from'../NativeViewGestureHandler';import GestureHandlerRootViewContext from'../../GestureHandlerRootViewContext';import{ghQueueMicrotask}from'../../ghQueueMicrotask';var ALLOWED_PROPS=[].concat(_toConsumableArray(baseGestureHandlerWithMonitorProps),_toConsumableArray(tapGestureHandlerProps),_toConsumableArray(panGestureHandlerProps),_toConsumableArray(panGestureHandlerCustomNativeProps),_toConsumableArray(longPressGestureHandlerProps),_toConsumableArray(forceTouchGestureHandlerProps),_toConsumableArray(flingGestureHandlerProps),_toConsumableArray(hoverGestureHandlerProps),_toConsumableArray(nativeViewGestureHandlerProps));function convertToHandlerTag(ref){if(typeof ref==='number'){return ref;}else if(ref instanceof BaseGesture){return ref.handlerTag;}else{var _ref$current$handlerT,_ref$current;return(_ref$current$handlerT=(_ref$current=ref.current)===null||_ref$current===void 0?void 0:_ref$current.handlerTag)!==null&&_ref$current$handlerT!==void 0?_ref$current$handlerT:-1;}}function extractValidHandlerTags(interactionGroup){var _interactionGroup$map,_interactionGroup$map2;return(_interactionGroup$map=interactionGroup===null||interactionGroup===void 0?void 0:(_interactionGroup$map2=interactionGroup.map(convertToHandlerTag))===null||_interactionGroup$map2===void 0?void 0:_interactionGroup$map2.filter(function(tag){return tag>0;}))!==null&&_interactionGroup$map!==void 0?_interactionGroup$map:[];}function dropHandlers(preparedGesture){for(var handler of preparedGesture.config){RNGestureHandlerModule.dropGestureHandler(handler.handlerTag);unregisterHandler(handler.handlerTag,handler.config.testId);}scheduleFlushOperations();}function checkGestureCallbacksForWorklets(gesture){if(gesture.config.runOnJS){return;}var areSomeNotWorklets=gesture.handlers.isWorklet.includes(false);var areSomeWorklets=gesture.handlers.isWorklet.includes(true);if(areSomeNotWorklets&&areSomeWorklets){console.error(tagMessage(`Some of the callbacks in the gesture are worklets and some are not. Either make sure that all calbacks are marked as 'worklet' if you wish to run them on the UI thread or use '.runOnJS(true)' modifier on the gesture explicitly to run all callbacks on the JS thread.`));}}function attachHandlers(_ref){var preparedGesture=_ref.preparedGesture,gestureConfig=_ref.gestureConfig,gesture=_ref.gesture,viewTag=_ref.viewTag,webEventHandlersRef=_ref.webEventHandlersRef,mountedRef=_ref.mountedRef;if(!preparedGesture.firstExecution){gestureConfig.initialize();}else{preparedGesture.firstExecution=false;}ghQueueMicrotask(function(){if(!mountedRef.current){return;}gestureConfig.prepare();});for(var handler of gesture){checkGestureCallbacksForWorklets(handler);RNGestureHandlerModule.createGestureHandler(handler.handlerName,handler.handlerTag,filterConfig(handler.config,ALLOWED_PROPS));registerHandler(handler.handlerTag,handler,handler.config.testId);}ghQueueMicrotask(function(){if(!mountedRef.current){return;}for(var _handler of gesture){var requireToFail=[];if(_handler.config.requireToFail){requireToFail=extractValidHandlerTags(_handler.config.requireToFail);}var simultaneousWith=[];if(_handler.config.simultaneousWith){simultaneousWith=extractValidHandlerTags(_handler.config.simultaneousWith);}var blocksHandlers=[];if(_handler.config.blocksHandlers){blocksHandlers=extractValidHandlerTags(_handler.config.blocksHandlers);}RNGestureHandlerModule.updateGestureHandler(_handler.handlerTag,filterConfig(_handler.config,ALLOWED_PROPS,{simultaneousHandlers:simultaneousWith,waitFor:requireToFail,blocksHandlers:blocksHandlers}));}scheduleFlushOperations();});preparedGesture.config=gesture;for(var _gesture of preparedGesture.config){var actionType=_gesture.shouldUseReanimated?ActionType.REANIMATED_WORKLET:ActionType.JS_FUNCTION_NEW_API;if(\"web\"==='web'){RNGestureHandlerModule.attachGestureHandler(_gesture.handlerTag,viewTag,ActionType.JS_FUNCTION_OLD_API,webEventHandlersRef);}else{RNGestureHandlerModule.attachGestureHandler(_gesture.handlerTag,viewTag,actionType);}}if(preparedGesture.animatedHandlers){var isAnimatedGesture=function isAnimatedGesture(g){return g.shouldUseReanimated;};preparedGesture.animatedHandlers.value=gesture.filter(isAnimatedGesture).map(function(g){return g.handlers;});}}function updateHandlers(preparedGesture,gestureConfig,gesture,mountedRef){gestureConfig.prepare();for(var i=0;i<gesture.length;i++){var handler=preparedGesture.config[i];checkGestureCallbacksForWorklets(handler);if(gesture[i].handlerTag!==handler.handlerTag){gesture[i].handlerTag=handler.handlerTag;gesture[i].handlers.handlerTag=handler.handlerTag;}}ghQueueMicrotask(function(){if(!mountedRef.current){return;}for(var _i=0;_i<gesture.length;_i++){var _handler2=preparedGesture.config[_i];_handler2.config=gesture[_i].config;_handler2.handlers=gesture[_i].handlers;var requireToFail=extractValidHandlerTags(_handler2.config.requireToFail);var simultaneousWith=extractValidHandlerTags(_handler2.config.simultaneousWith);RNGestureHandlerModule.updateGestureHandler(_handler2.handlerTag,filterConfig(_handler2.config,ALLOWED_PROPS,{simultaneousHandlers:simultaneousWith,waitFor:requireToFail}));registerHandler(_handler2.handlerTag,_handler2,_handler2.config.testId);}if(preparedGesture.animatedHandlers){var _preparedGesture$anim;var previousHandlersValue=(_preparedGesture$anim=preparedGesture.animatedHandlers.value)!==null&&_preparedGesture$anim!==void 0?_preparedGesture$anim:[];var newHandlersValue=preparedGesture.config.filter(function(g){return g.shouldUseReanimated;}).map(function(g){return g.handlers;});var shouldUpdateSharedValue=previousHandlersValue.length!==newHandlersValue.length;if(!shouldUpdateSharedValue){for(var _i2=0;_i2<newHandlersValue.length;_i2++){if(newHandlersValue[_i2].gestureId!==previousHandlersValue[_i2].gestureId){shouldUpdateSharedValue=true;break;}}}if(shouldUpdateSharedValue){preparedGesture.animatedHandlers.value=newHandlersValue;}}scheduleFlushOperations();});}function needsToReattach(preparedGesture,gesture){if(gesture.length!==preparedGesture.config.length){return true;}for(var i=0;i<gesture.length;i++){if(gesture[i].handlerName!==preparedGesture.config[i].handlerName||gesture[i].shouldUseReanimated!==preparedGesture.config[i].shouldUseReanimated){return true;}}return false;}var _worklet_13883357260557_init_data={code:\"function isStateChangeEvent(event){return event.oldState!=null;}\"};var isStateChangeEvent=function(){var isStateChangeEvent=function isStateChangeEvent(event){return event.oldState!=null;};isStateChangeEvent.__closure={};isStateChangeEvent.__workletHash=13883357260557;isStateChangeEvent.__initData=_worklet_13883357260557_init_data;return isStateChangeEvent;}();var _worklet_15872269086045_init_data={code:\"function isTouchEvent(event){return event.eventType!=null;}\"};var isTouchEvent=function(){var isTouchEvent=function isTouchEvent(event){return event.eventType!=null;};isTouchEvent.__closure={};isTouchEvent.__workletHash=15872269086045;isTouchEvent.__initData=_worklet_15872269086045_init_data;return isTouchEvent;}();var _worklet_12621821362088_init_data={code:\"function getHandler(type,gesture){const{CALLBACK_TYPE}=this.__closure;switch(type){case CALLBACK_TYPE.BEGAN:return gesture.onBegin;case CALLBACK_TYPE.START:return gesture.onStart;case CALLBACK_TYPE.UPDATE:return gesture.onUpdate;case CALLBACK_TYPE.CHANGE:return gesture.onChange;case CALLBACK_TYPE.END:return gesture.onEnd;case CALLBACK_TYPE.FINALIZE:return gesture.onFinalize;case CALLBACK_TYPE.TOUCHES_DOWN:return gesture.onTouchesDown;case CALLBACK_TYPE.TOUCHES_MOVE:return gesture.onTouchesMove;case CALLBACK_TYPE.TOUCHES_UP:return gesture.onTouchesUp;case CALLBACK_TYPE.TOUCHES_CANCELLED:return gesture.onTouchesCancelled;}}\"};var getHandler=function(){var getHandler=function getHandler(type,gesture){switch(type){case CALLBACK_TYPE.BEGAN:return gesture.onBegin;case CALLBACK_TYPE.START:return gesture.onStart;case CALLBACK_TYPE.UPDATE:return gesture.onUpdate;case CALLBACK_TYPE.CHANGE:return gesture.onChange;case CALLBACK_TYPE.END:return gesture.onEnd;case CALLBACK_TYPE.FINALIZE:return gesture.onFinalize;case CALLBACK_TYPE.TOUCHES_DOWN:return gesture.onTouchesDown;case CALLBACK_TYPE.TOUCHES_MOVE:return gesture.onTouchesMove;case CALLBACK_TYPE.TOUCHES_UP:return gesture.onTouchesUp;case CALLBACK_TYPE.TOUCHES_CANCELLED:return gesture.onTouchesCancelled;}};getHandler.__closure={CALLBACK_TYPE:CALLBACK_TYPE};getHandler.__workletHash=12621821362088;getHandler.__initData=_worklet_12621821362088_init_data;return getHandler;}();var _worklet_3914047291176_init_data={code:\"function touchEventTypeToCallbackType(eventType){const{TouchEventType,CALLBACK_TYPE}=this.__closure;switch(eventType){case TouchEventType.TOUCHES_DOWN:return CALLBACK_TYPE.TOUCHES_DOWN;case TouchEventType.TOUCHES_MOVE:return CALLBACK_TYPE.TOUCHES_MOVE;case TouchEventType.TOUCHES_UP:return CALLBACK_TYPE.TOUCHES_UP;case TouchEventType.TOUCHES_CANCELLED:return CALLBACK_TYPE.TOUCHES_CANCELLED;}return CALLBACK_TYPE.UNDEFINED;}\"};var touchEventTypeToCallbackType=function(){var touchEventTypeToCallbackType=function touchEventTypeToCallbackType(eventType){switch(eventType){case TouchEventType.TOUCHES_DOWN:return CALLBACK_TYPE.TOUCHES_DOWN;case TouchEventType.TOUCHES_MOVE:return CALLBACK_TYPE.TOUCHES_MOVE;case TouchEventType.TOUCHES_UP:return CALLBACK_TYPE.TOUCHES_UP;case TouchEventType.TOUCHES_CANCELLED:return CALLBACK_TYPE.TOUCHES_CANCELLED;}return CALLBACK_TYPE.UNDEFINED;};touchEventTypeToCallbackType.__closure={TouchEventType:TouchEventType,CALLBACK_TYPE:CALLBACK_TYPE};touchEventTypeToCallbackType.__workletHash=3914047291176;touchEventTypeToCallbackType.__initData=_worklet_3914047291176_init_data;return touchEventTypeToCallbackType;}();var _worklet_6944867991815_init_data={code:\"function runWorklet(type,gesture,event,...args){const{getHandler,tagMessage}=this.__closure;const handler=getHandler(type,gesture);if(gesture.isWorklet[type]){handler===null||handler===void 0?void 0:handler(event,...args);}else if(handler){console.warn(tagMessage('Animated gesture callback must be a worklet'));}}\"};var runWorklet=function(){var runWorklet=function runWorklet(type,gesture,event){var handler=getHandler(type,gesture);if(gesture.isWorklet[type]){for(var _len=arguments.length,args=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){args[_key-3]=arguments[_key];}handler===null||handler===void 0?void 0:handler.apply(void 0,[event].concat(args));}else if(handler){console.warn(tagMessage('Animated gesture callback must be a worklet'));}};runWorklet.__closure={getHandler:getHandler,tagMessage:tagMessage};runWorklet.__workletHash=6944867991815;runWorklet.__initData=_worklet_6944867991815_init_data;return runWorklet;}();var _worklet_14213353093337_init_data={code:\"function anonymous(event){const{sharedHandlersCallbacks,isStateChangeEvent,State,runWorklet,CALLBACK_TYPE,lastUpdateEvent,isTouchEvent,stateControllers,GestureStateManager,TouchEventType,touchEventTypeToCallbackType}=this.__closure;const currentCallback=sharedHandlersCallbacks.value;if(!currentCallback){return;}for(let i=0;i<currentCallback.length;i++){const gesture=currentCallback[i];if(event.handlerTag===gesture.handlerTag){if(isStateChangeEvent(event)){if(event.oldState===State.UNDETERMINED&&event.state===State.BEGAN){runWorklet(CALLBACK_TYPE.BEGAN,gesture,event);}else if((event.oldState===State.BEGAN||event.oldState===State.UNDETERMINED)&&event.state===State.ACTIVE){runWorklet(CALLBACK_TYPE.START,gesture,event);lastUpdateEvent.value[gesture.handlerTag]=undefined;}else if(event.oldState!==event.state&&event.state===State.END){if(event.oldState===State.ACTIVE){runWorklet(CALLBACK_TYPE.END,gesture,event,true);}runWorklet(CALLBACK_TYPE.FINALIZE,gesture,event,true);}else if((event.state===State.FAILED||event.state===State.CANCELLED)&&event.state!==event.oldState){if(event.oldState===State.ACTIVE){runWorklet(CALLBACK_TYPE.END,gesture,event,false);}runWorklet(CALLBACK_TYPE.FINALIZE,gesture,event,false);}}else if(isTouchEvent(event)){if(!stateControllers[i]){stateControllers[i]=GestureStateManager.create(event.handlerTag);}if(event.eventType!==TouchEventType.UNDETERMINED){runWorklet(touchEventTypeToCallbackType(event.eventType),gesture,event,stateControllers[i]);}}else{runWorklet(CALLBACK_TYPE.UPDATE,gesture,event);if(gesture.onChange&&gesture.changeEventCalculator){var _gesture$changeEventC;runWorklet(CALLBACK_TYPE.CHANGE,gesture,(_gesture$changeEventC=gesture.changeEventCalculator)===null||_gesture$changeEventC===void 0?void 0:_gesture$changeEventC.call(gesture,event,lastUpdateEvent.value[gesture.handlerTag]));lastUpdateEvent.value[gesture.handlerTag]=event;}}}}}\"};function useAnimatedGesture(preparedGesture,needsRebuild){if(!Reanimated){return;}var sharedHandlersCallbacks=Reanimated.useSharedValue(null);var lastUpdateEvent=Reanimated.useSharedValue([]);var stateControllers=[];var callback=function(){var anonymous=function anonymous(event){var currentCallback=sharedHandlersCallbacks.value;if(!currentCallback){return;}for(var i=0;i<currentCallback.length;i++){var gesture=currentCallback[i];if(event.handlerTag===gesture.handlerTag){if(isStateChangeEvent(event)){if(event.oldState===State.UNDETERMINED&&event.state===State.BEGAN){runWorklet(CALLBACK_TYPE.BEGAN,gesture,event);}else if((event.oldState===State.BEGAN||event.oldState===State.UNDETERMINED)&&event.state===State.ACTIVE){runWorklet(CALLBACK_TYPE.START,gesture,event);lastUpdateEvent.value[gesture.handlerTag]=undefined;}else if(event.oldState!==event.state&&event.state===State.END){if(event.oldState===State.ACTIVE){runWorklet(CALLBACK_TYPE.END,gesture,event,true);}runWorklet(CALLBACK_TYPE.FINALIZE,gesture,event,true);}else if((event.state===State.FAILED||event.state===State.CANCELLED)&&event.state!==event.oldState){if(event.oldState===State.ACTIVE){runWorklet(CALLBACK_TYPE.END,gesture,event,false);}runWorklet(CALLBACK_TYPE.FINALIZE,gesture,event,false);}}else if(isTouchEvent(event)){if(!stateControllers[i]){stateControllers[i]=GestureStateManager.create(event.handlerTag);}if(event.eventType!==TouchEventType.UNDETERMINED){runWorklet(touchEventTypeToCallbackType(event.eventType),gesture,event,stateControllers[i]);}}else{runWorklet(CALLBACK_TYPE.UPDATE,gesture,event);if(gesture.onChange&&gesture.changeEventCalculator){var _gesture$changeEventC;runWorklet(CALLBACK_TYPE.CHANGE,gesture,(_gesture$changeEventC=gesture.changeEventCalculator)===null||_gesture$changeEventC===void 0?void 0:_gesture$changeEventC.call(gesture,event,lastUpdateEvent.value[gesture.handlerTag]));lastUpdateEvent.value[gesture.handlerTag]=event;}}}}};anonymous.__closure={sharedHandlersCallbacks:sharedHandlersCallbacks,isStateChangeEvent:isStateChangeEvent,State:State,runWorklet:runWorklet,CALLBACK_TYPE:CALLBACK_TYPE,lastUpdateEvent:lastUpdateEvent,isTouchEvent:isTouchEvent,stateControllers:stateControllers,GestureStateManager:GestureStateManager,TouchEventType:TouchEventType,touchEventTypeToCallbackType:touchEventTypeToCallbackType};anonymous.__workletHash=14213353093337;anonymous.__initData=_worklet_14213353093337_init_data;return anonymous;}();var event=Reanimated.useEvent(callback,['onGestureHandlerStateChange','onGestureHandlerEvent'],needsRebuild);preparedGesture.animatedEventHandler=event;preparedGesture.animatedHandlers=sharedHandlersCallbacks;}function validateDetectorChildren(ref){if(false&&\"web\"!=='web'){var REACT_NATIVE_VERSION=getReactNativeVersion();var wrapType=REACT_NATIVE_VERSION.minor>63||REACT_NATIVE_VERSION.major>0?ref._reactInternals.elementType:ref._reactInternalFiber.elementType;var instance=RNRenderer.findHostInstance_DEPRECATED(ref)._internalFiberInstanceHandleDEV;while(instance&&instance.elementType!==wrapType){if(instance.sibling){throw new Error('GestureDetector has more than one native view as its children. This can happen if you are using a custom component that renders multiple views, like React.Fragment. You should wrap content of GestureDetector with a <View> or <Animated.View>.');}instance=instance.return;}}}var applyUserSelectProp=function applyUserSelectProp(userSelect,gesture){for(var g of gesture.toGestureArray()){g.config.userSelect=userSelect;}};export var GestureDetector=function GestureDetector(props){var rootViewContext=useContext(GestureHandlerRootViewContext);if(false&&!rootViewContext&&!isJestEnv()&&\"web\"!=='web'){throw new Error('GestureDetector must be used as a descendant of GestureHandlerRootView. Otherwise the gestures will not be recognized. See https://docs.swmansion.com/react-native-gesture-handler/docs/installation for more details.');}var gestureConfig=props.gesture;if(props.userSelect){applyUserSelectProp(props.userSelect,gestureConfig);}var gesture=gestureConfig.toGestureArray();var useReanimatedHook=gesture.some(function(g){return g.shouldUseReanimated;});var state=useRef({firstRender:true,viewRef:null,previousViewTag:-1,forceReattach:false}).current;var mountedRef=useRef(false);var webEventHandlersRef=useRef({onGestureHandlerEvent:function onGestureHandlerEvent(e){_onGestureHandlerEvent(e.nativeEvent);},onGestureHandlerStateChange:isNewWebImplementationEnabled()?function(e){_onGestureHandlerEvent(e.nativeEvent);}:undefined});var _useState=useState(false),_useState2=_slicedToArray(_useState,2),renderState=_useState2[0],setRenderState=_useState2[1];function forceRender(){setRenderState(!renderState);}var preparedGesture=React.useRef({config:gesture,animatedEventHandler:null,animatedHandlers:null,firstExecution:true,useReanimatedHook:useReanimatedHook}).current;if(useReanimatedHook!==preparedGesture.useReanimatedHook){throw new Error(tagMessage('You cannot change the thread the callbacks are ran on while the app is running'));}function onHandlersUpdate(skipConfigUpdate){var viewTag=findNodeHandle(state.viewRef);var forceReattach=viewTag!==state.previousViewTag;if(forceReattach||needsToReattach(preparedGesture,gesture)){validateDetectorChildren(state.viewRef);dropHandlers(preparedGesture);attachHandlers({preparedGesture:preparedGesture,gestureConfig:gestureConfig,gesture:gesture,webEventHandlersRef:webEventHandlersRef,viewTag:viewTag,mountedRef:mountedRef});state.previousViewTag=viewTag;state.forceReattach=forceReattach;if(forceReattach){forceRender();}}else if(!skipConfigUpdate){updateHandlers(preparedGesture,gestureConfig,gesture,mountedRef);}}var needsToRebuildReanimatedEvent=preparedGesture.firstExecution||needsToReattach(preparedGesture,gesture)||state.forceReattach;state.forceReattach=false;if(preparedGesture.firstExecution){gestureConfig.initialize();}if(useReanimatedHook){useAnimatedGesture(preparedGesture,needsToRebuildReanimatedEvent);}useEffect(function(){var viewTag=findNodeHandle(state.viewRef);state.firstRender=true;mountedRef.current=true;validateDetectorChildren(state.viewRef);attachHandlers({preparedGesture:preparedGesture,gestureConfig:gestureConfig,gesture:gesture,webEventHandlersRef:webEventHandlersRef,viewTag:viewTag,mountedRef:mountedRef});return function(){mountedRef.current=false;dropHandlers(preparedGesture);};},[]);useEffect(function(){if(!state.firstRender){onHandlersUpdate();}else{state.firstRender=false;}},[props]);var refFunction=function refFunction(ref){if(ref!==null){state.viewRef=ref;if(state.previousViewTag===-1){state.previousViewTag=findNodeHandle(state.viewRef);}onHandlersUpdate(true);if(isFabric()){var node=getShadowNodeFromRef(ref);if(global.isFormsStackingContext(node)===false){console.error(tagMessage('GestureDetector has received a child that may get view-flattened. '+'\\nTo prevent it from misbehaving you need to wrap the child with a `<View collapsable={false}>`.'));}}}};if(useReanimatedHook){return React.createElement(AnimatedWrap,{ref:refFunction,onGestureHandlerEvent:preparedGesture.animatedEventHandler},props.children);}else{return React.createElement(Wrap,{ref:refFunction},props.children);}};var Wrap=function(_React$Component){_inherits(Wrap,_React$Component);var _super=_createSuper(Wrap);function Wrap(){_classCallCheck(this,Wrap);return _super.apply(this,arguments);}_createClass(Wrap,[{key:\"render\",value:function render(){try{var child=React.Children.only(this.props.children);return React.cloneElement(child,{collapsable:false},child.props.children);}catch(e){throw new Error(tagMessage(`GestureDetector got more than one view as a child. If you want the gesture to work on multiple views, wrap them with a common parent and attach the gesture to that view.`));}}}]);return Wrap;}(React.Component);var AnimatedWrap=(_Reanimated$default$c=Reanimated===null||Reanimated===void 0?void 0:(_Reanimated$default=Reanimated.default)===null||_Reanimated$default===void 0?void 0:_Reanimated$default.createAnimatedComponent(Wrap))!==null&&_Reanimated$default$c!==void 0?_Reanimated$default$c:Wrap;","map":{"version":3,"sources":["GestureDetector.tsx"],"names":["React","useContext","useEffect","useRef","useState","BaseGesture","CALLBACK_TYPE","Reanimated","registerHandler","unregisterHandler","RNGestureHandlerModule","baseGestureHandlerWithMonitorProps","filterConfig","findNodeHandle","scheduleFlushOperations","GestureStateManager","flingGestureHandlerProps","forceTouchGestureHandlerProps","longPressGestureHandlerProps","panGestureHandlerProps","panGestureHandlerCustomNativeProps","tapGestureHandlerProps","hoverGestureHandlerProps","State","TouchEventType","ActionType","isFabric","isJestEnv","tagMessage","getReactNativeVersion","getShadowNodeFromRef","onGestureHandlerEvent","RNRenderer","isNewWebImplementationEnabled","nativeViewGestureHandlerProps","GestureHandlerRootViewContext","ghQueueMicrotask","ALLOWED_PROPS","convertToHandlerTag","ref","handlerTag","current","extractValidHandlerTags","interactionGroup","map","filter","tag","dropHandlers","preparedGesture","handler","config","dropGestureHandler","testId","checkGestureCallbacksForWorklets","gesture","runOnJS","areSomeNotWorklets","handlers","isWorklet","includes","areSomeWorklets","console","error","attachHandlers","gestureConfig","viewTag","webEventHandlersRef","mountedRef","firstExecution","initialize","prepare","createGestureHandler","handlerName","requireToFail","simultaneousWith","blocksHandlers","updateGestureHandler","simultaneousHandlers","waitFor","actionType","shouldUseReanimated","REANIMATED_WORKLET","JS_FUNCTION_NEW_API","Platform","attachGestureHandler","JS_FUNCTION_OLD_API","animatedHandlers","isAnimatedGesture","g","value","updateHandlers","i","length","previousHandlersValue","newHandlersValue","shouldUpdateSharedValue","gestureId","needsToReattach","isStateChangeEvent","event","oldState","isTouchEvent","eventType","getHandler","type","BEGAN","onBegin","START","onStart","UPDATE","onUpdate","CHANGE","onChange","END","onEnd","FINALIZE","onFinalize","TOUCHES_DOWN","onTouchesDown","TOUCHES_MOVE","onTouchesMove","TOUCHES_UP","onTouchesUp","TOUCHES_CANCELLED","onTouchesCancelled","touchEventTypeToCallbackType","UNDEFINED","runWorklet","args","warn","useAnimatedGesture","needsRebuild","sharedHandlersCallbacks","useSharedValue","lastUpdateEvent","stateControllers","callback","currentCallback","UNDETERMINED","state","ACTIVE","undefined","FAILED","CANCELLED","create","changeEventCalculator","useEvent","animatedEventHandler","validateDetectorChildren","__DEV__","REACT_NATIVE_VERSION","wrapType","minor","major","_reactInternals","elementType","_reactInternalFiber","instance","findHostInstance_DEPRECATED","_internalFiberInstanceHandleDEV","sibling","Error","return","applyUserSelectProp","userSelect","toGestureArray","GestureDetector","props","rootViewContext","useReanimatedHook","some","firstRender","viewRef","previousViewTag","forceReattach","e","nativeEvent","onGestureHandlerStateChange","renderState","setRenderState","forceRender","onHandlersUpdate","skipConfigUpdate","needsToRebuildReanimatedEvent","refFunction","node","global","isFormsStackingContext","children","Wrap","Component","render","child","Children","only","cloneElement","collapsable","AnimatedWrap","default","createAnimatedComponent"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useState } from 'react';\nimport {\n  GestureType,\n  HandlerCallbacks,\n  BaseGesture,\n  GestureRef,\n  CALLBACK_TYPE,\n} from './gesture';\nimport { Reanimated, SharedValue } from './reanimatedWrapper';\nimport { registerHandler, unregisterHandler } from '../handlersRegistry';\nimport RNGestureHandlerModule from '../../RNGestureHandlerModule';\nimport {\n  baseGestureHandlerWithMonitorProps,\n  filterConfig,\n  findNodeHandle,\n  GestureTouchEvent,\n  GestureUpdateEvent,\n  GestureStateChangeEvent,\n  HandlerStateChangeEvent,\n  scheduleFlushOperations,\n  UserSelect,\n} from '../gestureHandlerCommon';\nimport {\n  GestureStateManager,\n  GestureStateManagerType,\n} from './gestureStateManager';\nimport { flingGestureHandlerProps } from '../FlingGestureHandler';\nimport { forceTouchGestureHandlerProps } from '../ForceTouchGestureHandler';\nimport { longPressGestureHandlerProps } from '../LongPressGestureHandler';\nimport {\n  panGestureHandlerProps,\n  panGestureHandlerCustomNativeProps,\n} from '../PanGestureHandler';\nimport { tapGestureHandlerProps } from '../TapGestureHandler';\nimport { hoverGestureHandlerProps } from './hoverGesture';\nimport { State } from '../../State';\nimport { TouchEventType } from '../../TouchEventType';\nimport { ComposedGesture } from './gestureComposition';\nimport { ActionType } from '../../ActionType';\nimport { isFabric, isJestEnv, tagMessage } from '../../utils';\nimport { getReactNativeVersion } from '../../getReactNativeVersion';\nimport { getShadowNodeFromRef } from '../../getShadowNodeFromRef';\nimport { Platform } from 'react-native';\nimport type RNGestureHandlerModuleWeb from '../../RNGestureHandlerModule.web';\nimport { onGestureHandlerEvent } from './eventReceiver';\nimport { RNRenderer } from '../../RNRenderer';\nimport { isNewWebImplementationEnabled } from '../../EnableNewWebImplementation';\nimport { nativeViewGestureHandlerProps } from '../NativeViewGestureHandler';\nimport GestureHandlerRootViewContext from '../../GestureHandlerRootViewContext';\nimport { ghQueueMicrotask } from '../../ghQueueMicrotask';\n\ndeclare const global: {\n  isFormsStackingContext: (node: unknown) => boolean | null; // JSI function\n};\n\nconst ALLOWED_PROPS = [\n  ...baseGestureHandlerWithMonitorProps,\n  ...tapGestureHandlerProps,\n  ...panGestureHandlerProps,\n  ...panGestureHandlerCustomNativeProps,\n  ...longPressGestureHandlerProps,\n  ...forceTouchGestureHandlerProps,\n  ...flingGestureHandlerProps,\n  ...hoverGestureHandlerProps,\n  ...nativeViewGestureHandlerProps,\n];\n\nexport type GestureConfigReference = {\n  config: GestureType[];\n  animatedEventHandler: unknown;\n  animatedHandlers: SharedValue<\n    HandlerCallbacks<Record<string, unknown>>[] | null\n  > | null;\n  firstExecution: boolean;\n  useReanimatedHook: boolean;\n};\n\nfunction convertToHandlerTag(ref: GestureRef): number {\n  if (typeof ref === 'number') {\n    return ref;\n  } else if (ref instanceof BaseGesture) {\n    return ref.handlerTag;\n  } else {\n    // @ts-ignore in this case it should be a ref either to gesture object or\n    // a gesture handler component, in both cases handlerTag property exists\n    return ref.current?.handlerTag ?? -1;\n  }\n}\n\nfunction extractValidHandlerTags(interactionGroup: GestureRef[] | undefined) {\n  return (\n    interactionGroup?.map(convertToHandlerTag)?.filter((tag) => tag > 0) ?? []\n  );\n}\n\nfunction dropHandlers(preparedGesture: GestureConfigReference) {\n  for (const handler of preparedGesture.config) {\n    RNGestureHandlerModule.dropGestureHandler(handler.handlerTag);\n\n    unregisterHandler(handler.handlerTag, handler.config.testId);\n  }\n\n  scheduleFlushOperations();\n}\n\nfunction checkGestureCallbacksForWorklets(gesture: GestureType) {\n  // if a gesture is explicitly marked to run on the JS thread there is no need to check\n  // if callbacks are worklets as the user is aware they will be ran on the JS thread\n  if (gesture.config.runOnJS) {\n    return;\n  }\n\n  const areSomeNotWorklets = gesture.handlers.isWorklet.includes(false);\n  const areSomeWorklets = gesture.handlers.isWorklet.includes(true);\n\n  // if some of the callbacks are worklets and some are not, and the gesture is not\n  // explicitly marked with `.runOnJS(true)` show an error\n  if (areSomeNotWorklets && areSomeWorklets) {\n    console.error(\n      tagMessage(\n        `Some of the callbacks in the gesture are worklets and some are not. Either make sure that all calbacks are marked as 'worklet' if you wish to run them on the UI thread or use '.runOnJS(true)' modifier on the gesture explicitly to run all callbacks on the JS thread.`\n      )\n    );\n  }\n}\n\ninterface WebEventHandler {\n  onGestureHandlerEvent: (event: HandlerStateChangeEvent<unknown>) => void;\n  onGestureHandlerStateChange?: (\n    event: HandlerStateChangeEvent<unknown>\n  ) => void;\n}\n\ninterface AttachHandlersConfig {\n  preparedGesture: GestureConfigReference;\n  gestureConfig: ComposedGesture | GestureType;\n  gesture: GestureType[];\n  viewTag: number;\n  webEventHandlersRef: React.RefObject<WebEventHandler>;\n  mountedRef: React.RefObject<boolean>;\n}\n\nfunction attachHandlers({\n  preparedGesture,\n  gestureConfig,\n  gesture,\n  viewTag,\n  webEventHandlersRef,\n  mountedRef,\n}: AttachHandlersConfig) {\n  if (!preparedGesture.firstExecution) {\n    gestureConfig.initialize();\n  } else {\n    preparedGesture.firstExecution = false;\n  }\n\n  // use queueMicrotask to extract handlerTags, because all refs should be initialized\n  // when it's ran\n  ghQueueMicrotask(() => {\n    if (!mountedRef.current) {\n      return;\n    }\n    gestureConfig.prepare();\n  });\n\n  for (const handler of gesture) {\n    checkGestureCallbacksForWorklets(handler);\n    RNGestureHandlerModule.createGestureHandler(\n      handler.handlerName,\n      handler.handlerTag,\n      filterConfig(handler.config, ALLOWED_PROPS)\n    );\n\n    registerHandler(handler.handlerTag, handler, handler.config.testId);\n  }\n\n  // use queueMicrotask to extract handlerTags, because all refs should be initialized\n  // when it's ran\n  ghQueueMicrotask(() => {\n    if (!mountedRef.current) {\n      return;\n    }\n    for (const handler of gesture) {\n      let requireToFail: number[] = [];\n      if (handler.config.requireToFail) {\n        requireToFail = extractValidHandlerTags(handler.config.requireToFail);\n      }\n\n      let simultaneousWith: number[] = [];\n      if (handler.config.simultaneousWith) {\n        simultaneousWith = extractValidHandlerTags(\n          handler.config.simultaneousWith\n        );\n      }\n\n      let blocksHandlers: number[] = [];\n      if (handler.config.blocksHandlers) {\n        blocksHandlers = extractValidHandlerTags(handler.config.blocksHandlers);\n      }\n\n      RNGestureHandlerModule.updateGestureHandler(\n        handler.handlerTag,\n        filterConfig(handler.config, ALLOWED_PROPS, {\n          simultaneousHandlers: simultaneousWith,\n          waitFor: requireToFail,\n          blocksHandlers: blocksHandlers,\n        })\n      );\n    }\n\n    scheduleFlushOperations();\n  });\n\n  preparedGesture.config = gesture;\n\n  for (const gesture of preparedGesture.config) {\n    const actionType = gesture.shouldUseReanimated\n      ? ActionType.REANIMATED_WORKLET\n      : ActionType.JS_FUNCTION_NEW_API;\n\n    if (Platform.OS === 'web') {\n      (\n        RNGestureHandlerModule.attachGestureHandler as typeof RNGestureHandlerModuleWeb.attachGestureHandler\n      )(\n        gesture.handlerTag,\n        viewTag,\n        ActionType.JS_FUNCTION_OLD_API, // ignored on web\n        webEventHandlersRef\n      );\n    } else {\n      RNGestureHandlerModule.attachGestureHandler(\n        gesture.handlerTag,\n        viewTag,\n        actionType\n      );\n    }\n  }\n\n  if (preparedGesture.animatedHandlers) {\n    const isAnimatedGesture = (g: GestureType) => g.shouldUseReanimated;\n\n    preparedGesture.animatedHandlers.value = gesture\n      .filter(isAnimatedGesture)\n      .map((g) => g.handlers) as unknown as HandlerCallbacks<\n      Record<string, unknown>\n    >[];\n  }\n}\n\nfunction updateHandlers(\n  preparedGesture: GestureConfigReference,\n  gestureConfig: ComposedGesture | GestureType,\n  gesture: GestureType[],\n  mountedRef: React.RefObject<boolean>\n) {\n  gestureConfig.prepare();\n\n  for (let i = 0; i < gesture.length; i++) {\n    const handler = preparedGesture.config[i];\n    checkGestureCallbacksForWorklets(handler);\n\n    // only update handlerTag when it's actually different, it may be the same\n    // if gesture config object is wrapped with useMemo\n    if (gesture[i].handlerTag !== handler.handlerTag) {\n      gesture[i].handlerTag = handler.handlerTag;\n      gesture[i].handlers.handlerTag = handler.handlerTag;\n    }\n  }\n\n  // use queueMicrotask to extract handlerTags, because when it's ran, all refs should be updated\n  // and handlerTags in BaseGesture references should be updated in the loop above (we need to wait\n  // in case of external relations)\n  ghQueueMicrotask(() => {\n    if (!mountedRef.current) {\n      return;\n    }\n    for (let i = 0; i < gesture.length; i++) {\n      const handler = preparedGesture.config[i];\n\n      handler.config = gesture[i].config;\n      handler.handlers = gesture[i].handlers;\n\n      const requireToFail = extractValidHandlerTags(\n        handler.config.requireToFail\n      );\n\n      const simultaneousWith = extractValidHandlerTags(\n        handler.config.simultaneousWith\n      );\n\n      RNGestureHandlerModule.updateGestureHandler(\n        handler.handlerTag,\n        filterConfig(handler.config, ALLOWED_PROPS, {\n          simultaneousHandlers: simultaneousWith,\n          waitFor: requireToFail,\n        })\n      );\n\n      registerHandler(handler.handlerTag, handler, handler.config.testId);\n    }\n\n    if (preparedGesture.animatedHandlers) {\n      const previousHandlersValue =\n        preparedGesture.animatedHandlers.value ?? [];\n      const newHandlersValue = preparedGesture.config\n        .filter((g) => g.shouldUseReanimated) // ignore gestures that shouldn't run on UI\n        .map((g) => g.handlers) as unknown as HandlerCallbacks<\n        Record<string, unknown>\n      >[];\n\n      // if amount of gesture configs changes, we need to update the callbacks in shared value\n      let shouldUpdateSharedValue =\n        previousHandlersValue.length !== newHandlersValue.length;\n\n      if (!shouldUpdateSharedValue) {\n        // if the amount is the same, we need to check if any of the configs inside has changed\n        for (let i = 0; i < newHandlersValue.length; i++) {\n          if (\n            // we can use the `gestureId` prop as it's unique for every config instance\n            newHandlersValue[i].gestureId !== previousHandlersValue[i].gestureId\n          ) {\n            shouldUpdateSharedValue = true;\n            break;\n          }\n        }\n      }\n\n      if (shouldUpdateSharedValue) {\n        preparedGesture.animatedHandlers.value = newHandlersValue;\n      }\n    }\n\n    scheduleFlushOperations();\n  });\n}\n\nfunction needsToReattach(\n  preparedGesture: GestureConfigReference,\n  gesture: GestureType[]\n) {\n  if (gesture.length !== preparedGesture.config.length) {\n    return true;\n  }\n  for (let i = 0; i < gesture.length; i++) {\n    if (\n      gesture[i].handlerName !== preparedGesture.config[i].handlerName ||\n      gesture[i].shouldUseReanimated !==\n        preparedGesture.config[i].shouldUseReanimated\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction isStateChangeEvent(\n  event: GestureUpdateEvent | GestureStateChangeEvent | GestureTouchEvent\n): event is GestureStateChangeEvent {\n  'worklet';\n  // @ts-ignore Yes, the oldState prop is missing on GestureTouchEvent, that's the point\n  return event.oldState != null;\n}\n\nfunction isTouchEvent(\n  event: GestureUpdateEvent | GestureStateChangeEvent | GestureTouchEvent\n): event is GestureTouchEvent {\n  'worklet';\n  return event.eventType != null;\n}\n\nfunction getHandler(\n  type: CALLBACK_TYPE,\n  gesture: HandlerCallbacks<Record<string, unknown>>\n) {\n  'worklet';\n  switch (type) {\n    case CALLBACK_TYPE.BEGAN:\n      return gesture.onBegin;\n    case CALLBACK_TYPE.START:\n      return gesture.onStart;\n    case CALLBACK_TYPE.UPDATE:\n      return gesture.onUpdate;\n    case CALLBACK_TYPE.CHANGE:\n      return gesture.onChange;\n    case CALLBACK_TYPE.END:\n      return gesture.onEnd;\n    case CALLBACK_TYPE.FINALIZE:\n      return gesture.onFinalize;\n    case CALLBACK_TYPE.TOUCHES_DOWN:\n      return gesture.onTouchesDown;\n    case CALLBACK_TYPE.TOUCHES_MOVE:\n      return gesture.onTouchesMove;\n    case CALLBACK_TYPE.TOUCHES_UP:\n      return gesture.onTouchesUp;\n    case CALLBACK_TYPE.TOUCHES_CANCELLED:\n      return gesture.onTouchesCancelled;\n  }\n}\n\nfunction touchEventTypeToCallbackType(\n  eventType: TouchEventType\n): CALLBACK_TYPE {\n  'worklet';\n  switch (eventType) {\n    case TouchEventType.TOUCHES_DOWN:\n      return CALLBACK_TYPE.TOUCHES_DOWN;\n    case TouchEventType.TOUCHES_MOVE:\n      return CALLBACK_TYPE.TOUCHES_MOVE;\n    case TouchEventType.TOUCHES_UP:\n      return CALLBACK_TYPE.TOUCHES_UP;\n    case TouchEventType.TOUCHES_CANCELLED:\n      return CALLBACK_TYPE.TOUCHES_CANCELLED;\n  }\n  return CALLBACK_TYPE.UNDEFINED;\n}\n\nfunction runWorklet(\n  type: CALLBACK_TYPE,\n  gesture: HandlerCallbacks<Record<string, unknown>>,\n  event: GestureStateChangeEvent | GestureUpdateEvent | GestureTouchEvent,\n  ...args: any[]\n) {\n  'worklet';\n  const handler = getHandler(type, gesture);\n  if (gesture.isWorklet[type]) {\n    // @ts-ignore Logic below makes sure the correct event is send to the\n    // correct handler.\n    handler?.(event, ...args);\n  } else if (handler) {\n    console.warn(tagMessage('Animated gesture callback must be a worklet'));\n  }\n}\n\nfunction useAnimatedGesture(\n  preparedGesture: GestureConfigReference,\n  needsRebuild: boolean\n) {\n  if (!Reanimated) {\n    return;\n  }\n\n  // Hooks are called conditionally, but the condition is whether the\n  // react-native-reanimated is installed, which shouldn't change while running\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const sharedHandlersCallbacks = Reanimated.useSharedValue<\n    HandlerCallbacks<Record<string, unknown>>[] | null\n  >(null);\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const lastUpdateEvent = Reanimated.useSharedValue<\n    (GestureUpdateEvent | undefined)[]\n  >([]);\n\n  // not every gesture needs a state controller, init them lazily\n  const stateControllers: GestureStateManagerType[] = [];\n\n  const callback = (\n    event: GestureStateChangeEvent | GestureUpdateEvent | GestureTouchEvent\n  ) => {\n    'worklet';\n\n    const currentCallback = sharedHandlersCallbacks.value;\n    if (!currentCallback) {\n      return;\n    }\n\n    for (let i = 0; i < currentCallback.length; i++) {\n      const gesture = currentCallback[i];\n\n      if (event.handlerTag === gesture.handlerTag) {\n        if (isStateChangeEvent(event)) {\n          if (\n            event.oldState === State.UNDETERMINED &&\n            event.state === State.BEGAN\n          ) {\n            runWorklet(CALLBACK_TYPE.BEGAN, gesture, event);\n          } else if (\n            (event.oldState === State.BEGAN ||\n              event.oldState === State.UNDETERMINED) &&\n            event.state === State.ACTIVE\n          ) {\n            runWorklet(CALLBACK_TYPE.START, gesture, event);\n            lastUpdateEvent.value[gesture.handlerTag] = undefined;\n          } else if (\n            event.oldState !== event.state &&\n            event.state === State.END\n          ) {\n            if (event.oldState === State.ACTIVE) {\n              runWorklet(CALLBACK_TYPE.END, gesture, event, true);\n            }\n            runWorklet(CALLBACK_TYPE.FINALIZE, gesture, event, true);\n          } else if (\n            (event.state === State.FAILED || event.state === State.CANCELLED) &&\n            event.state !== event.oldState\n          ) {\n            if (event.oldState === State.ACTIVE) {\n              runWorklet(CALLBACK_TYPE.END, gesture, event, false);\n            }\n            runWorklet(CALLBACK_TYPE.FINALIZE, gesture, event, false);\n          }\n        } else if (isTouchEvent(event)) {\n          if (!stateControllers[i]) {\n            stateControllers[i] = GestureStateManager.create(event.handlerTag);\n          }\n\n          if (event.eventType !== TouchEventType.UNDETERMINED) {\n            runWorklet(\n              touchEventTypeToCallbackType(event.eventType),\n              gesture,\n              event,\n              stateControllers[i]\n            );\n          }\n        } else {\n          runWorklet(CALLBACK_TYPE.UPDATE, gesture, event);\n\n          if (gesture.onChange && gesture.changeEventCalculator) {\n            runWorklet(\n              CALLBACK_TYPE.CHANGE,\n              gesture,\n              gesture.changeEventCalculator?.(\n                event,\n                lastUpdateEvent.value[gesture.handlerTag]\n              )\n            );\n\n            lastUpdateEvent.value[gesture.handlerTag] = event;\n          }\n        }\n      }\n    }\n  };\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const event = Reanimated.useEvent(\n    callback,\n    ['onGestureHandlerStateChange', 'onGestureHandlerEvent'],\n    needsRebuild\n  );\n\n  preparedGesture.animatedEventHandler = event;\n  preparedGesture.animatedHandlers = sharedHandlersCallbacks;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction validateDetectorChildren(ref: any) {\n  // finds the first native view under the Wrap component and traverses the fiber tree upwards\n  // to check whether there is more than one native view as a pseudo-direct child of GestureDetector\n  // i.e. this is not ok:\n  //            Wrap\n  //             |\n  //            / \\\n  //           /   \\\n  //          /     \\\n  //         /       \\\n  //   NativeView  NativeView\n  //\n  // but this is fine:\n  //            Wrap\n  //             |\n  //         NativeView\n  //             |\n  //            / \\\n  //           /   \\\n  //          /     \\\n  //         /       \\\n  //   NativeView  NativeView\n  if (__DEV__ && Platform.OS !== 'web') {\n    const REACT_NATIVE_VERSION = getReactNativeVersion();\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    const wrapType =\n      REACT_NATIVE_VERSION.minor > 63 || REACT_NATIVE_VERSION.major > 0\n        ? // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          ref._reactInternals.elementType\n        : // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          ref._reactInternalFiber.elementType;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    let instance =\n      RNRenderer.findHostInstance_DEPRECATED(\n        ref\n      )._internalFiberInstanceHandleDEV;\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    while (instance && instance.elementType !== wrapType) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (instance.sibling) {\n        throw new Error(\n          'GestureDetector has more than one native view as its children. This can happen if you are using a custom component that renders multiple views, like React.Fragment. You should wrap content of GestureDetector with a <View> or <Animated.View>.'\n        );\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      instance = instance.return;\n    }\n  }\n}\n\nconst applyUserSelectProp = (\n  userSelect: UserSelect,\n  gesture: ComposedGesture | GestureType\n): void => {\n  for (const g of gesture.toGestureArray()) {\n    g.config.userSelect = userSelect;\n  }\n};\n\ninterface GestureDetectorProps {\n  gesture: ComposedGesture | GestureType;\n  userSelect?: UserSelect;\n  children?: React.ReactNode;\n}\ninterface GestureDetectorState {\n  firstRender: boolean;\n  viewRef: React.Component | null;\n  previousViewTag: number;\n  forceReattach: boolean;\n}\nexport const GestureDetector = (props: GestureDetectorProps) => {\n  const rootViewContext = useContext(GestureHandlerRootViewContext);\n  if (__DEV__ && !rootViewContext && !isJestEnv() && Platform.OS !== 'web') {\n    throw new Error(\n      'GestureDetector must be used as a descendant of GestureHandlerRootView. Otherwise the gestures will not be recognized. See https://docs.swmansion.com/react-native-gesture-handler/docs/installation for more details.'\n    );\n  }\n\n  const gestureConfig = props.gesture;\n\n  if (props.userSelect) {\n    applyUserSelectProp(props.userSelect, gestureConfig);\n  }\n\n  const gesture = gestureConfig.toGestureArray();\n  const useReanimatedHook = gesture.some((g) => g.shouldUseReanimated);\n\n  // store state in ref to prevent unnecessary renders\n  const state = useRef<GestureDetectorState>({\n    firstRender: true,\n    viewRef: null,\n    previousViewTag: -1,\n    forceReattach: false,\n  }).current;\n  const mountedRef = useRef(false);\n  const webEventHandlersRef = useRef<WebEventHandler>({\n    onGestureHandlerEvent: (e: HandlerStateChangeEvent<unknown>) => {\n      onGestureHandlerEvent(e.nativeEvent);\n    },\n    onGestureHandlerStateChange: isNewWebImplementationEnabled()\n      ? (e: HandlerStateChangeEvent<unknown>) => {\n          onGestureHandlerEvent(e.nativeEvent);\n        }\n      : undefined,\n  });\n\n  const [renderState, setRenderState] = useState(false);\n  function forceRender() {\n    setRenderState(!renderState);\n  }\n\n  const preparedGesture = React.useRef<GestureConfigReference>({\n    config: gesture,\n    animatedEventHandler: null,\n    animatedHandlers: null,\n    firstExecution: true,\n    useReanimatedHook: useReanimatedHook,\n  }).current;\n\n  if (useReanimatedHook !== preparedGesture.useReanimatedHook) {\n    throw new Error(\n      tagMessage(\n        'You cannot change the thread the callbacks are ran on while the app is running'\n      )\n    );\n  }\n\n  function onHandlersUpdate(skipConfigUpdate?: boolean) {\n    // if the underlying view has changed we need to reattach handlers to the new view\n    const viewTag = findNodeHandle(state.viewRef) as number;\n    const forceReattach = viewTag !== state.previousViewTag;\n\n    if (forceReattach || needsToReattach(preparedGesture, gesture)) {\n      validateDetectorChildren(state.viewRef);\n      dropHandlers(preparedGesture);\n      attachHandlers({\n        preparedGesture,\n        gestureConfig,\n        gesture,\n        webEventHandlersRef,\n        viewTag,\n        mountedRef,\n      });\n\n      state.previousViewTag = viewTag;\n      state.forceReattach = forceReattach;\n      if (forceReattach) {\n        forceRender();\n      }\n    } else if (!skipConfigUpdate) {\n      updateHandlers(preparedGesture, gestureConfig, gesture, mountedRef);\n    }\n  }\n\n  // Reanimated event should be rebuilt only when gestures are reattached, otherwise\n  // config update will be enough as all necessary items are stored in shared values anyway\n  const needsToRebuildReanimatedEvent =\n    preparedGesture.firstExecution ||\n    needsToReattach(preparedGesture, gesture) ||\n    state.forceReattach;\n\n  state.forceReattach = false;\n\n  if (preparedGesture.firstExecution) {\n    gestureConfig.initialize();\n  }\n\n  if (useReanimatedHook) {\n    // Whether animatedGesture or gesture is used shouldn't change while the app is running\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    useAnimatedGesture(preparedGesture, needsToRebuildReanimatedEvent);\n  }\n\n  useEffect(() => {\n    const viewTag = findNodeHandle(state.viewRef) as number;\n    state.firstRender = true;\n    mountedRef.current = true;\n\n    validateDetectorChildren(state.viewRef);\n\n    attachHandlers({\n      preparedGesture,\n      gestureConfig,\n      gesture,\n      webEventHandlersRef,\n      viewTag,\n      mountedRef,\n    });\n\n    return () => {\n      mountedRef.current = false;\n      dropHandlers(preparedGesture);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!state.firstRender) {\n      onHandlersUpdate();\n    } else {\n      state.firstRender = false;\n    }\n  }, [props]);\n\n  const refFunction = (ref: unknown) => {\n    if (ref !== null) {\n      // @ts-ignore Just setting the view ref\n      state.viewRef = ref;\n\n      // if it's the first render, also set the previousViewTag to prevent reattaching gestures when not needed\n      if (state.previousViewTag === -1) {\n        state.previousViewTag = findNodeHandle(state.viewRef) as number;\n      }\n\n      // pass true as `skipConfigUpdate`, here we only want to trigger the eventual reattaching of handlers\n      // in case the view has changed, while config update would be handled be the `useEffect` above\n      onHandlersUpdate(true);\n\n      if (isFabric()) {\n        const node = getShadowNodeFromRef(ref);\n        if (global.isFormsStackingContext(node) === false) {\n          console.error(\n            tagMessage(\n              'GestureDetector has received a child that may get view-flattened. ' +\n                '\\nTo prevent it from misbehaving you need to wrap the child with a `<View collapsable={false}>`.'\n            )\n          );\n        }\n      }\n    }\n  };\n\n  if (useReanimatedHook) {\n    return (\n      <AnimatedWrap\n        ref={refFunction}\n        onGestureHandlerEvent={preparedGesture.animatedEventHandler}>\n        {props.children}\n      </AnimatedWrap>\n    );\n  } else {\n    return <Wrap ref={refFunction}>{props.children}</Wrap>;\n  }\n};\n\nclass Wrap extends React.Component<{\n  onGestureHandlerEvent?: unknown;\n  // implicit `children` prop has been removed in @types/react^18.0.0\n  children?: React.ReactNode;\n}> {\n  render() {\n    try {\n      // I don't think that fighting with types over such a simple function is worth it\n      // The only thing it does is add 'collapsable: false' to the child component\n      // to make sure it is in the native view hierarchy so the detector can find\n      // correct viewTag to attach to.\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const child: any = React.Children.only(this.props.children);\n      return React.cloneElement(\n        child,\n        { collapsable: false },\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        child.props.children\n      );\n    } catch (e) {\n      throw new Error(\n        tagMessage(\n          `GestureDetector got more than one view as a child. If you want the gesture to work on multiple views, wrap them with a common parent and attach the gesture to that view.`\n        )\n      );\n    }\n  }\n}\n\nconst AnimatedWrap = Reanimated?.default?.createAnimatedComponent(Wrap) ?? Wrap;\n"]},"metadata":{},"sourceType":"module"}