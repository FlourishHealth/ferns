{"ast":null,"code":"'use strict';import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,\"string\");return typeof key===\"symbol\"?key:String(key);}function _toPrimitive(input,hint){if(typeof input!==\"object\"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||\"default\");if(typeof res!==\"object\")return res;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(hint===\"string\"?String:Number)(input);}import NativeEventEmitter from\"react-native-web/dist/exports/NativeEventEmitter\";import NativeModules from\"react-native-web/dist/exports/NativeModules\";import findNodeHandle from\"react-native-web/dist/exports/findNodeHandle\";import{shouldBeUseWeb}from'../reanimated2/PlatformChecker';import{runOnJS,runOnUIImmediately}from'../reanimated2/threads';var SHOULD_BE_USE_WEB=shouldBeUseWeb();var JSPropsUpdaterPaper=function(){function JSPropsUpdaterPaper(){_classCallCheck(this,JSPropsUpdaterPaper);_defineProperty(this,\"_reanimatedEventEmitter\",void 0);this._reanimatedEventEmitter=new NativeEventEmitter(NativeModules.ReanimatedModule);}_createClass(JSPropsUpdaterPaper,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(animatedComponent){var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterPaper._tagToComponentMapping.set(viewTag,animatedComponent);if(JSPropsUpdaterPaper._tagToComponentMapping.size===1){var listener=function listener(data){var component=JSPropsUpdaterPaper._tagToComponentMapping.get(data.viewTag);component===null||component===void 0?void 0:component._updateFromNative(data.props);};this._reanimatedEventEmitter.addListener('onReanimatedPropsChange',listener);}}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(animatedComponent){var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterPaper._tagToComponentMapping.delete(viewTag);if(JSPropsUpdaterPaper._tagToComponentMapping.size===0){this._reanimatedEventEmitter.removeAllListeners('onReanimatedPropsChange');}}}]);return JSPropsUpdaterPaper;}();_defineProperty(JSPropsUpdaterPaper,\"_tagToComponentMapping\",new Map());var _worklet_9991293657914_init_data={code:\"function anonymous(){const{runOnJS,updater}=this.__closure;global.updateJSProps=function(viewTag,props){runOnJS(updater)(viewTag,props);};}\"};var JSPropsUpdaterFabric=function(){function JSPropsUpdaterFabric(){_classCallCheck(this,JSPropsUpdaterFabric);if(!JSPropsUpdaterFabric.isInitialized){var updater=function updater(viewTag,props){var component=JSPropsUpdaterFabric._tagToComponentMapping.get(viewTag);component===null||component===void 0?void 0:component._updateFromNative(props);};runOnUIImmediately(function(){var anonymous=function anonymous(){global.updateJSProps=function(viewTag,props){runOnJS(updater)(viewTag,props);};};anonymous.__closure={runOnJS:runOnJS,updater:updater};anonymous.__workletHash=9991293657914;anonymous.__initData=_worklet_9991293657914_init_data;return anonymous;}())();JSPropsUpdaterFabric.isInitialized=true;}}_createClass(JSPropsUpdaterFabric,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(animatedComponent){if(!JSPropsUpdaterFabric.isInitialized){return;}var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterFabric._tagToComponentMapping.set(viewTag,animatedComponent);}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(animatedComponent){if(!JSPropsUpdaterFabric.isInitialized){return;}var viewTag=findNodeHandle(animatedComponent);JSPropsUpdaterFabric._tagToComponentMapping.delete(viewTag);}}]);return JSPropsUpdaterFabric;}();_defineProperty(JSPropsUpdaterFabric,\"_tagToComponentMapping\",new Map());_defineProperty(JSPropsUpdaterFabric,\"isInitialized\",false);var JSPropsUpdaterWeb=function(){function JSPropsUpdaterWeb(){_classCallCheck(this,JSPropsUpdaterWeb);}_createClass(JSPropsUpdaterWeb,[{key:\"addOnJSPropsChangeListener\",value:function addOnJSPropsChangeListener(_animatedComponent){}},{key:\"removeOnJSPropsChangeListener\",value:function removeOnJSPropsChangeListener(_animatedComponent){}}]);return JSPropsUpdaterWeb;}();var JSPropsUpdater;if(SHOULD_BE_USE_WEB){JSPropsUpdater=JSPropsUpdaterWeb;}else if(global._IS_FABRIC){JSPropsUpdater=JSPropsUpdaterFabric;}else{JSPropsUpdater=JSPropsUpdaterPaper;}export default JSPropsUpdater;","map":{"version":3,"sources":["JSPropsUpdater.ts"],"names":["shouldBeUseWeb","runOnJS","runOnUIImmediately","SHOULD_BE_USE_WEB","JSPropsUpdaterPaper","Map","constructor","_defineProperty","_reanimatedEventEmitter","NativeEventEmitter","NativeModules","ReanimatedModule","addOnJSPropsChangeListener","animatedComponent","viewTag","findNodeHandle","_tagToComponentMapping","set","size","listener","data","component","get","_updateFromNative","props","addListener","removeOnJSPropsChangeListener","delete","removeAllListeners","JSPropsUpdaterFabric","isInitialized","updater","global","updateJSProps","JSPropsUpdaterWeb","_animatedComponent","JSPropsUpdater","_IS_FABRIC"],"mappings":"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","sourcesContent":["'use strict';\nimport {\n  NativeEventEmitter,\n  NativeModules,\n  findNodeHandle,\n} from 'react-native';\nimport { shouldBeUseWeb } from '../reanimated2/PlatformChecker';\nimport type { StyleProps } from '../reanimated2';\nimport { runOnJS, runOnUIImmediately } from '../reanimated2/threads';\nimport type {\n  AnimatedComponentProps,\n  IAnimatedComponentInternal,\n  IJSPropsUpdater,\n  InitialComponentProps,\n} from './commonTypes';\n\ninterface ListenerData {\n  viewTag: number;\n  props: StyleProps;\n}\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\nclass JSPropsUpdaterPaper implements IJSPropsUpdater {\n  private static _tagToComponentMapping = new Map();\n  private _reanimatedEventEmitter: NativeEventEmitter;\n\n  constructor() {\n    this._reanimatedEventEmitter = new NativeEventEmitter(\n      NativeModules.ReanimatedModule\n    );\n  }\n\n  public addOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterPaper._tagToComponentMapping.set(viewTag, animatedComponent);\n    if (JSPropsUpdaterPaper._tagToComponentMapping.size === 1) {\n      const listener = (data: ListenerData) => {\n        const component = JSPropsUpdaterPaper._tagToComponentMapping.get(\n          data.viewTag\n        );\n        component?._updateFromNative(data.props);\n      };\n      this._reanimatedEventEmitter.addListener(\n        'onReanimatedPropsChange',\n        listener\n      );\n    }\n  }\n\n  public removeOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterPaper._tagToComponentMapping.delete(viewTag);\n    if (JSPropsUpdaterPaper._tagToComponentMapping.size === 0) {\n      this._reanimatedEventEmitter.removeAllListeners(\n        'onReanimatedPropsChange'\n      );\n    }\n  }\n}\n\nclass JSPropsUpdaterFabric implements IJSPropsUpdater {\n  private static _tagToComponentMapping = new Map();\n  private static isInitialized = false;\n\n  constructor() {\n    if (!JSPropsUpdaterFabric.isInitialized) {\n      const updater = (viewTag: number, props: unknown) => {\n        const component =\n          JSPropsUpdaterFabric._tagToComponentMapping.get(viewTag);\n        component?._updateFromNative(props);\n      };\n      runOnUIImmediately(() => {\n        'worklet';\n        global.updateJSProps = (viewTag: number, props: unknown) => {\n          runOnJS(updater)(viewTag, props);\n        };\n      })();\n      JSPropsUpdaterFabric.isInitialized = true;\n    }\n  }\n\n  public addOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    if (!JSPropsUpdaterFabric.isInitialized) {\n      return;\n    }\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterFabric._tagToComponentMapping.set(viewTag, animatedComponent);\n  }\n\n  public removeOnJSPropsChangeListener(\n    animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    if (!JSPropsUpdaterFabric.isInitialized) {\n      return;\n    }\n    const viewTag = findNodeHandle(animatedComponent);\n    JSPropsUpdaterFabric._tagToComponentMapping.delete(viewTag);\n  }\n}\n\nclass JSPropsUpdaterWeb implements IJSPropsUpdater {\n  public addOnJSPropsChangeListener(\n    _animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    // noop\n  }\n\n  public removeOnJSPropsChangeListener(\n    _animatedComponent: React.Component<\n      AnimatedComponentProps<InitialComponentProps>\n    > &\n      IAnimatedComponentInternal\n  ) {\n    // noop\n  }\n}\n\ntype JSPropsUpdaterOptions =\n  | typeof JSPropsUpdaterWeb\n  | typeof JSPropsUpdaterFabric\n  | typeof JSPropsUpdaterPaper;\n\nlet JSPropsUpdater: JSPropsUpdaterOptions;\nif (SHOULD_BE_USE_WEB) {\n  JSPropsUpdater = JSPropsUpdaterWeb;\n} else if (global._IS_FABRIC) {\n  JSPropsUpdater = JSPropsUpdaterFabric;\n} else {\n  JSPropsUpdater = JSPropsUpdaterPaper;\n}\n\nexport default JSPropsUpdater;\n"]},"metadata":{},"sourceType":"module"}